from sage.plot.plot3d.plot3d import axes
var('x,y,z,t,s')
scale=2; a=3/4;b=1/2 ;x0=1;y0=1;
f(x,y)=2*exp(-(x-1/2)^2/2-y^2/4)
plot3=axes(scale,1,color="black",frame=False,aspect_ratio=1)+text3d("x",(scale+0.5,0,0),fontsize=30)+text3d("y",(0,scale+0.5,0),fontsize=30)+text3d("z",(0,0,scale+0.5),fontsize=30)
param(s,t)=(s,t,f(s,t))
#set up grid      n is number of steps in s    m is number of steps in t  
#a1 is min s    a2 is max s   b1 is min t    b2 is max t
n=6;m=6;a1=0;a2=2;b1=0;b2=2; 
#c1 is surface color     o1 is surface opacity
#c2 and o2 are for constant t value traces
#c3 and o3 are for constant s value traces
c1="gray"; c2="black"; c3="black"; o1=0.2; o2=0.2; o3=0.2;
plot99=parametric_plot3d(param,(s,a1,a2),(t,b1,b2),color=c1,opacity=o1)
for i in range(n+1):
  sv=a1+i/n*(a2-a1)
  plot99+=parametric_plot3d(param(sv,t),(t,b1,b2),color=c2,opacity=o2)
for i in range(m+1):
  tv=b1+i/m*(b2-b1)
  plot99+=parametric_plot3d(param(s,tv),(s,a1,a2),color=c3,opacity=o3)
plot3+=plot99
#plot3+=plot3d(f(x,y),(x,0,2),(y,0,2),color="gray",plot_points=13,opacity=0.3)
plot3+=parametric_plot3d((x0+a*t,y0+b*t,f(x0+a*t,y0+b*t)),(t,-1.5,1.5),color="gray",opacity=0.8,thickness=2)
#plot3+=parametric_plot3d((x0+a*t,y0+b*t,s),(t,-1,1.5),(s,0,2),color="gray",opacity=0.4,mesh=True,plot_points=3)
plot3+=point((x0,y0,f(x0,y0)),color="red",size=20)+point((x0+a,y0+b,f(x0+a,y0+b)),color="red",size=20)
plot3+=arrow3d((x0,y0,0),(x0+a,y0+b,0),color="blue")+text3d("\u27E8a,b\u27E9",(a+0.25+x0,b+0.25+y0,0),color="blue",fontsize=20)
plot3+=line([(x0-b/2,y0+a/2,0),(x0,y0,0),(x0+a,y0+b,0),(x0+a-b/2,y0+b+a/2,0)],color="blue",thickness=2)
plot3+=text3d("change",(x0+a/2-b/2,y0+b/2+a/2,-0.1),color="blue",fontsize=20)+text3d("in input",(x0+a/2-b/2,y0+b/2+a/2,-0.3),color="blue",fontsize=20)
plot3+=line([(x0,y0,f(x0,y0)),(0,0,f(x0,y0))],color="red",thickness=2)
plot3+=line([(x0+a,y0+b,f(x0+a,y0+b)),(0,0,f(x0+a,y0+b))],color="red",thickness=2)
plot3+=text3d("change",(-0.75,0,(f(x0,y0)+f(x0+a,y0+b))/2+0.1),color="red",fontsize=20)
plot3+=text3d("in output",(-0.75,0,(f(x0,y0)+f(x0+a,y0+b))/2-0.1),color="red",fontsize=20)
plot3+=arrow((0,0,(f(x0,y0)+f(x0+a,y0+b))/2),(0,0,f(x0+a,y0+b)),color="red",width=1.5)
plot3+=arrow((0,0,(f(x0,y0)+f(x0+a,y0+b))/2),(0,0,f(x0,y0)),color="red",width=1.5)
plot3+=text3d("(x\u2080,y\u2080,f(x\u2080,y\u2080))",(x0+1,y0+0.25,f(x0,y0)),color="red",fontsize=20)
plot3+=line([(x0,y0,f(x0,y0)),(x0,y0,0)],color="black",thickness=1,linestyle="--")
plot3+=line([(x0+a,y0+b,f(x0+a,y0+b)),(x0+a,y0+b,0)],color="black",thickness=1,linestyle='--')
#plot3+=text3d("(x\u2080+a,y\u2080+b,f(x\u2080+a,y\u2080+b))",(x0+0.85+a,y0+0.85+b,f(x0+a,y0+b)),color="red",fontsize=20)
show(plot3,viewpoint=[[0.0419,-0.6647,-0.746],185.38],camera_position=[0.0587,7.6574,1.8523])