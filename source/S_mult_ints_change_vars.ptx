<?xml version="1.0"?>
<!-- **********************************************************************-->
<!-- Copyright 2013-2025                                                   -->
<!-- Nicholas Long, Mitchel Keller, Steven Schlicker                       -->
<!--                                                                       -->
<!-- This file is part of Active Calculus Multivariable.                   -->
<!--                                                                       -->
<!-- Permission is granted to copy, distribute and/or modify this document -->
<!-- under the terms of the Creative Commons BY-NC-SA license.  The work   -->
<!-- may be used for free by any party so long as attribution is given to  -->
<!-- the author(s), the work and its derivatives are used in the spirit of -->
<!-- "share and share alike"; no party may sell this work or any of its    -->
<!-- derivatives for profit.  All trademarks are the registered marks of   -->
<!-- their respective owners.                                              -->
<!-- **********************************************************************-->
<section xml:id="S-11-9-Change-of-Variable" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Change of Variables</title>
  <objectives>
      <ul>
        <li>
          <p>
            What is a change of variables in a multivariable coordinate system?
          </p>
        </li>

        <li>
          <p>
            How can we measure how area and volume are distorted for a change of variables in two or three dimensions?
          </p>
        </li>
      </ul>
  </objectives>
  <introduction component="instructor">
    <title>Notes to the Instructor and Dependencies</title>
    <p>
      Many instructors use <xref ref="S-11-8-Triple-Integrals-Cylindrical-Spherical"/> as an introduction to the general setting of this section and other skip this generalization. We do not address how to find these advantageous changes of coordinates which will transform regions from non-rectangular to rectangular (in the new coordinate space), but rather we develop the Jacobian as the key element in these transitions between coordinates. Also of note, the more time you spent on visualizing regions and setting boundary conditions will yield great benefits in the time needed for students to practice the ideas in this section.
    </p>
  </introduction>
  <subsection>
    <title>Introduction</title>
    <p>
      In single variable calculus, we encountered the idea of a change of variable in a definite integral through the method of substitution. For example, given the definite integral
      <me>
        \int_0^2 2x(x^2+1)^3 \, dx,
      </me>
      we naturally consider the change of variable <m>u = x^2+1</m>. From this substitution, it follows that <m>du = 2x \, dx</m>, and since <m>x = 0</m> implies <m>u = 1</m> and <m>x = 2</m> implies <m>u = 5</m>, we have transformed the original integral in <m>x</m> into a new integral in <m>u</m>. In particular,
      <me>
        \int_0^2 2x(x^2+1)^3 \, dx = \int_1^5 u^3 \, du.
      </me>
    </p>

    <p>
      The latter integral, of course, is far easier to evaluate.
    </p>

    <p>
      Through our work with polar, cylindrical, and spherical coordinates, we have already seen some of the issues and advantages that arise from using a change of variables with two or three variables. In the following Preview Activity, we will look geometrically at a couple of examples of changes of coordinates involving polar coordinates. In particular, we will explore exactly what properties an advantageous change of coordinates will have. In what follows, we seek to understand the general ideas behind any change of variables in a multiple integral.
    </p>

    <worksheet>
  <exploration workspace="1.5in"
 xml:id="PA_11_9">
      <task>
        <statement>
          <p>
            Consider the double integral
            <men xml:id="eq_11_9_COV_PA"> 
              I = \iint_D x^2+y^2 \, dA    
            </men> 
            where <m>D</m> is the upper half of the unit disk (<m>y \geq 0</m>). Remember the polar conversion equations:
            <men xml:id="eq_11_9_pol_to_rect">
              x = r \cos(\theta)  \quad \text{ and }  \quad y = r \sin(\theta)
            </men>
          </p>
          <task>
            <statement>
              <p>
                Write the double integral <m>I</m> given in Equation<nbsp/><xref ref="eq_11_9_COV_PA"/> as an iterated integral in rectangular coordinates.
              </p>
            </statement>
            <solution>
              <p>
                The double integral <xref ref="eq_11_9_COV_PA"/> can be evaluated in rectangular coordinates as the iterated integral
                <me>
                  \int_{-1}^1 \int_{0}^{\sqrt{1-x^2}} x^2 + y^2 \, dy \, dx
                </me>
              </p>
            </solution>
          </task>
          <task>
            <statement>
              <p>
                Write the double integral <m>I</m> given in Equation<nbsp/> <xref ref="eq_11_9_COV_PA"/> as an iterated integral in polar coordinates.
              </p>
            </statement>
            <solution>
              <p>
                By making the change of variables <m>x = r\cos(\theta)</m> and <m>y = r\sin(\theta)</m>, and <m>dA = r \, dr \, d\theta</m>, we express the double integral <xref ref="eq_11_9_COV_PA"/> as the iterated integral
                <me>
                  \int_0^{\pi} \int_0^1 r^2 r \, dr \, d\theta
                </me>
                in polar coordinates.
              </p>
            </solution>
          </task>
          <task>
            <statement>
              <p>
                Draw a plot of the region of integration <m>D</m> in the <m>xy</m>-plane and label the four <q>corners</q> of the polar coordinates (if <m>D</m> is described by <m>a \leq r \leq b , c \leq \theta \leq d</m>, then the corners will be <m>(r,\theta)=(a,c),(a,d),(b,c),(b,d)</m>).
              </p>
            </statement>
            <hint>
              <p>
                Two of your <q>corners</q> will be at the same point
              </p>
            </hint>
            <solution>
              <p>
                <image width="60%">
                  <sageplot>
                    points=[(cos(i/100*pi),sin(i/100*pi)) for i in range(0,101)]
                    plot5=polygon(points,color="gray",edgecolor="black",thickness=2,ticks=[[-1,0,1],[0,1]])
                    plot5+=point((1,0),size=40,color="black")
                    plot5+=text("$(x=1,y=0)$",(1.1,-0.1),color="black",fontsize=15)
                    plot5+=text("$(r=1,\\theta=0)$",(1.1,-0.2),color="black",fontsize=15)
                    plot5+=point((-1,0),size=40,color="black")
                    plot5+=text("$(x=-1,y=0)$",(-1.1,-0.1),color="black",fontsize=15)
                    plot5+=text("$(r=1,\\theta=\\pi)$",(-1.1,-0.2),color="black",fontsize=15)
                    plot5+=point((0,0),size=40,color="black")
                    plot5+=text("$(x=0,y=0)$",(0,-0.1),color="black",fontsize=15)
                    plot5+=text("$(r=0,\\theta=0)$",(0,-0.2),color="black",fontsize=15)
                    plot5+=text("$(r=0,\\theta=\\pi)$",(0,-0.3),color="black",fontsize=15)
                    plot5                  
                  </sageplot>
                </image>
              </p>
            </solution>
          </task>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Suppose you are calibrating a new radar system for your self driving car. This radar system is mounted at the center of your front bumper and can detect objects up to 45 degrees to either side of the forward direction at distances from 1 meter to 3 meters.
          </p>
          <task>
            <statement>
              <p>
                On <xref ref="polarplane1"/>, draw a plot of <m>S</m>, the region that your radar system can detect objects. Assume your car's front bumper is centered at the origin of your coordinate system and the car is facing the positive <m>y</m>-direction. You should label the four corners of <m>S</m> in terms of <em>both</em> rectangular and polar coordinates. 
              </p>
              <figure xml:id="polarplane1">
                <caption>A polar grid</caption>
                <image width="60%" xml:id="img-polarplane1">
                  <sageplot>
                    var('s,t,x,y')
                    rvs=[i for i in range(1,6)]
                    tvs=[i*pi/8 for i in range(1,16)]
                    plot3=point((0,0),size=0,color="black",axes_labels=["$x$","$y$"],xmin=-4,xmax=4,ymin=-4,ymax=4)
                    for r in rvs:
                        plot3+=parametric_plot((r*cos(t),r*sin(t)),(t,0,2*pi),color="gray",linestyle="--")
                    for tv in tvs:
                        plot3+=line([(0,0),(6*cos(tv),6*sin(tv))],color="gray")
                    plot3                  
                  </sageplot>
                </image>
              </figure>
            </statement>
            <solution>
              <p>
                <image width="60%" >
                  <sageplot>
                    points=[(3*cos(pi/4+(i/100)*pi/2 ),3*sin(pi/4+(i/100)*pi/2)) for i in range(0,101)]
                    points2=[(cos(3*pi/4-(i/100)*pi/2 ),sin(3*pi/4-(i/100)*pi/2)) for i in range(0,101)]
                    points=points+points2
                    plot5=polygon(points,color="gray",edgecolor="black",thickness=2,ticks=[[-3,-2,-1,0,1,2,3],[0,1,2,3]])
                    s=1/sqrt(2)
                    plot5+=point((s,s),size=40,color="black")
                    plot5+=text("$(x=\\frac{\\sqrt{2}}{2},y=\\frac{\\sqrt{2}}{2})$",(s+.1,s-.2),color="black",fontsize=15)
                    plot5+=text("$(r=1,\\theta=\\frac{\\pi}{4})$",(s+.1,s-.5),color="black",fontsize=15)
                    plot5+=point((-s,s),size=40,color="black")
                    plot5+=text("$(x=-\\frac{\\sqrt{2}}{2},y=\\frac{\\sqrt{2}}{2})$",(-s+.1,s-.2),color="black",fontsize=15)
                    plot5+=text("$(r=1,\\theta=\\frac{3\\pi}{4})$",(-s+.1,s-.5),color="black",fontsize=15)
                    plot5+=point((3*s,3*s),size=40,color="black")
                    plot5+=text("$(x=\\frac{3\\sqrt{2}}{2},y=\\frac{3\\sqrt{2}}{2})$",(3*s+.1,3*s+.2),color="black",fontsize=15)
                    plot5+=text("$(r=3,\\theta=\\frac{\\pi}{4})$",(3*s+.1,3*s+.5),color="black",fontsize=15)
                    plot5+=point((-3*s,3*s),size=40,color="black")
                    plot5+=text("$(x=-\\frac{3\\sqrt{2}}{2},y=\\frac{3\\sqrt{2}}{2})$",(-3*s+.1,3*s+.2),color="black",fontsize=15)
                    plot5+=text("$(r=3,\\theta=\\frac{3\\pi}{4})$",(-3*s+.1,3*s+.5),color="black",fontsize=15)
                    plot5                  
                  </sageplot>
                </image>
              </p>
            </solution>
          </task>
          <task>
            <statement>
              <p>
                On <xref ref="planegrid"/>, plot the rectangle on the <m>r\theta</m>-plane that corresponds to the bounds <m>a \leq r \leq b \quad c \leq \theta \leq d</m> for your radar system. Label the four corners of your figure with their <m>r</m> and <m>\theta</m> coordinates.
              </p>
              <figure xml:id="planegrid">
                <caption>A grid on the <m>\theta r </m>-plane</caption>
                <image width="60%" xml:id="img-planegrid">
                  <sageplot>
                    from matplotlib import ticker
                    plot4=point((0,0),size=0,color="black",axes_labels=["$\\theta$","$r$"],xmin=0,xmax=6,ymin=0,ymax=6,gridlines=True,tick_formatter=(ticker.NullFormatter(),
                    ticker.NullFormatter()))
                    plot4                 
                  </sageplot>
                </image>
              </figure>
            </statement>
            <solution>
              <image>
                <sageplot>
                  from matplotlib import ticker
                  plot6=point((0,0),size=0,color="black",axes_labels=["$\\theta$","$r$"],xmin=0,xmax=4,ymin=0,ymax=4,gridlines=True,tick_formatter=(ticker.NullFormatter(),
                  ticker.NullFormatter()))
                  plot6+=polygon([(1,1),(3,1),(3,3),(1,3)],color="gray",edgecolor="black",thickness=2)
                  plot6+=point((1,1),size=40,color="black")
                  plot6+=text("$(r=1,\\theta=\\frac{\\pi}{4})$",(1+.1,1-.5),color="black",fontsize=15)
                  plot6+=point((1,3),size=40,color="black")
                  plot6+=text("$(r=3,\\theta=\\frac{\\pi}{4})$",(1+.1,3+.5),color="black",fontsize=15)
                  plot6+=point((3,1),size=40,color="black")
                  plot6+=text("$(r=1,\\theta=\\frac{3\\pi}{4})$",(3+.1,1-.5),color="black",fontsize=15)
                  plot6+=point((3,3),size=40,color="black")
                  plot6+=text("$(r=3,\\theta=\\frac{3\\pi}{4})$",(3+.1,3+.5),color="black",fontsize=15)
                  plot6
                </sageplot>
              </image>   
            </solution>
          </task>
        </statement>
      </task>
      

          <!-- <li>
            <p>
            When we write the double integral <xref ref="eq_11_9_COV_PA"/> as an iterated integral in polar coordinates we make a change of variables, namely
            <men xml:id="eq_11_9_pol_to_rect">
            x = r \cos(\theta)  \ \ \ \ \ \text{ and }  \ \ \ \ \ y = r \sin(\theta).
            </men>
            </p>

            <p>
              We also then have to change <m>dA</m> to <m>r \, dr \, d\theta</m>. This process also identifies a <q>polar rectangle</q> <m>[r_1, r_2] \times [\theta_1, \theta_2]</m> with the original Cartesian rectangle, under the transformation<fn>A <em>transformation</em> is another name for function:  here, the equations <m>x = r\cos(\theta)</m> and <m>y = r\sin(\theta)</m> define a function <m>T</m> by <m>T(r, \theta) = (r\cos(\theta), r\sin(\theta))</m> so that <m>T</m> is a function (transformation) from <m>\R^2</m> to <m>\R^2</m>.  We view this transformation as mapping a version of the <m>xy</m>-plane where the axes are viewed as representing <m>r</m> and <m>\theta</m> (the <m>r \theta</m>-plane) to the familiar <m>xy</m>-plane.</fn> in Equation <xref ref="eq_11_9_pol_to_rect"/>. The vertices of the polar rectangle are transformed into the vertices of a closed and bounded region in rectangular coordinates.
            </p>

            <p>
              To work with a numerical example, let's now consider the polar rectangle <m>P</m> given by <m>[1, 2] \times [\frac{\pi}{6}, \frac{\pi}{4}]</m>, so that <m>r_1 = 1</m>, <m>r_2=2</m>, <m>\theta_1 = \frac{\pi}{6}</m>, and <m>\theta_2 = \frac{\pi}{4}</m>.
            </p>
            
            <ol marker="i.">
              <li>
                <p>
                  Use the transformation determined by the equations in<nbsp/><xref ref="eq_11_9_pol_to_rect"/> to find the rectangular vertices that correspond to the polar vertices in the polar rectangle <m>P</m>. In other words, by substituting appropriate values of <m>r</m> and <m>\theta</m> into the two equations in<nbsp/><xref ref="eq_11_9_pol_to_rect"/>, find the values of the corresponding <m>x</m> and <m>y</m> coordinates for the vertices of the polar rectangle <m>P</m>. Label the point that corresponds to the polar vertex <m>(r_1, \theta_1)</m> as <m>(x_1, y_1)</m>, the point corresponding to the polar vertex <m>(r_2, \theta_1)</m> as <m>(x_2, y_2)</m>, the point corresponding to the polar vertex <m>(r_1, \theta_2)</m> as <m>(x_3, y_3)</m>, and the point corresponding to the polar vertex <m>(r_2, \theta_2)</m> as <m>(x_4, y_4)</m>.
                </p>
              </li>

              <li>
               <p>
                  Draw a picture of the figure in rectangular coordinates that has the points <m>(x_1,y_1)</m>, <m>(x_2,y_2)</m>, <m>(x_3, y_3)</m>, and <m>(x_4,y_4)</m> as vertices. (Note carefully that because of the trigonometric functions in the transformation, this region will not look like a Cartesian rectangle.) What is the area of this region in rectangular coordinates? How does this area compare to the area of the original polar rectangle?
                </p>
              </li>
            </ol>
          </li>
        </ol>
      </statement> <solution>
        <ul>
          <li>
            <p>
              .
            </p>
          </li>
          <li>
            <p>
              By making the change of variables
              <m>x = r\cos(\theta)</m> and <m>y = r\sin(\theta)</m>,
              and <m>dA = r \, dr \, d\theta</m>,
              we express the double integral <xref ref="eq_11_9_COV_PA"/> as the iterated integral
              <me>
                \int_0^{\pi} \int_0^1 r^2 r \, dr \, d\theta
              </me>
              in polar coordinates.
            </p>
          </li>
          <li>
            <p>
              Under the transformations in <xref ref="eq_11_9_pol_to_rect"/>
              <ul>
                <li>
                  <p>
                    the vertex <m>(r_1, \theta_1) = \left(1, \frac{\pi}{6}\right)</m> is sent to the point <m>(x_1, y_1) = \left(\frac{\sqrt{3}}{2}, \frac{1}{2}\right)</m>,
                  </p>
                </li>
                <li>
                  <p>
                    the vertex <m>(r_2, \theta_1) = \left(2, \frac{\pi}{6}\right)</m> is sent to the point <m>(x_2, y_2) = \left(\sqrt{3}, 1 \right)</m>,
                  </p>
                </li>
                <li>
                  <p>
                    the vertex <m>(r_1, \theta_2) = \left(1, \frac{\pi}{4}\right)</m> is sent to the point <m>(x_3, y_3) = \left(\frac{\sqrt{2}}{2}, \frac{\sqrt{2}}{2}\right)</m>,
                  </p>
                </li>
                <li>
                  <p>
                    the vertex <m>(r_2, \theta_2) = \left(2, \frac{\pi}{4}\right)</m> is sent to the point <m>(x_4, y_4) = \left(\sqrt{2}, \sqrt{2}\right)</m>.
                  </p>
                </li>
              </ul>
            </p>
          </li>
          <li>
            <p>
              If we lived in polar coordinates,
              the polar rectangle <m>P</m> would look to us as shown below at left.
              The image <m>P'</m> of the polar rectangle <m>P</m> under the transformations in <xref ref="eq_11_9_pol_to_rect"/> is shown below at right.
          
              <image width="73%" source="images/fig_11_9_Polar_COV_1"/> 
              
              <image width="73%" source="images/fig_11_9_Polar_COV_2"/> 
              
              We have seen that the area of the transformed rectangle <m>P'</m> is given by <m>\frac{r_2+r_1}{2} \Delta r \Delta \theta</m>,
              and as <m>\Delta r</m> and
              <m>\Delta \theta</m> go to 0 this area becomes the area element <m>dA = r \, dr \, d\theta</m>.
              This is the general idea of a change of variables in multiple integrals.
            </p>
          </li>
        </ul>
      </solution>-->
    </exploration>
</worksheet>
  </subsection>

  <subsection>
    <title>Change of Variables in Polar Coordinates</title>
    <p>
      The general idea behind a change of variables is suggested by <xref ref="PA_11_9">Preview Activity</xref>. There, we saw that in a change of variables from rectangular coordinates to polar coordinates, a polar rectangle <m>[r_1, r_2] \times [\theta_1, \theta_2]</m> gets mapped to a Cartesian rectangle under the transformation
      <me>
        x = r \cos(\theta)  \quad \text{ and }  \quad y = r \sin(\theta).
      </me>
    </p>
    <example>
      <p>
        The vertices of the polar rectangle <m>P</m> given by <m>[r_1, r_2] \times [\theta_1, \theta_2]</m> are transformed into the vertices of a closed and bounded region <m>P'</m> in rectangular coordinates. If we view the standard coordinate system as having the horizontal axis represent <m>r</m> and the vertical axis represent <m>\theta</m>, then the polar rectangle <m>P</m> appears to us at left in <xref ref="F_11_9_Change_vars1_a">Figure</xref>. The image <m>P'</m> of the polar rectangle <m>P</m> under the transformation given by <xref ref="eq_11_9_pol_to_rect"/> is shown at right in <xref ref="F_11_9_Change_vars1_a">Figure</xref>. We thus see that there is a correspondence between a simple region (a traditional, right-angled rectangle) and a more complicated region (a fraction of an annulus) under the function <m>T</m> given by <m>T(r, \theta) = (r\cos(\theta), r\sin(\theta))</m>.
      </p>
      <figure xml:id="F_11_9_Change_vars1_a">
        <caption>A rectangle <m>P</m> and its image <m>P'</m>.</caption>
        <image width="100%" source="images/fig_11_9_polar_change"/>
      </figure>
    </example>
    <p>
      Furthermore, it follows generally that for an original polar rectangle <m>P = [r_1, r_2] \times [\theta_1, \theta_2]</m>, the area of the transformed rectangle <m>P'</m> is given by <m>\frac{r_2+r_1}{2} \Delta r \Delta \theta</m>. Therefore, as <m>\Delta r</m> and <m>\Delta \theta</m> go to 0, this area becomes the familiar area element <m>dA = r \, dr \, d\theta</m> in polar coordinates. When we work with other transformations for different changes in coordinates, we will have to understand how the transformation affects area so that we may use the correct area element in the new system of variables.
    </p>
  </subsection>
  <subsection>
    <title>General Change of Coordinates</title>
    <p>
      We first focus on double integrals. As with single integrals, we may be able to simplify a double integral of the form
      <me>
        \iint_D f(x,y) \, dA
      </me>
      by making a change of variables (that is, a substitution) of the form
      <me>
        x = x(s, t) \quad \text{ and }  \quad  y = y(s, t)
      </me>
      where <m>x</m> and <m>y</m> are functions of new variables <m>s</m> and <m>t</m>. This transformation introduces a correspondence between a problem in the <m>xy</m>-plane and one in the the <m>st</m>-plane. The equations <m>x=x(s,t)</m> and <m>y=y(s,t)</m> convert <m>s</m> and <m>t</m> to <m>x</m> and <m>y</m>; we call these formulas the <em>change of variable</em> formulas. 
    </p>
    <p>  
      To complete the change of our integral to the new <m>s,t</m> variables, we need to 
      <ol>
        <li>understand the area element, <m>dA</m>, in terms of <m>s</m> and <m>t</m></li>
        <li>transform the integrand (with the change of variable formulas)</li>
        <li>write the new region (in the <m>st</m>-plane) with a vertically or horizontally simple description</li>
      </ol>
     The following activity helps to illustrate the idea behind describing the new region in the <m>st</m>-plane.
    </p>

    <!-- <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_1">
      <statement> 
      <p>
        Consider the change of variables
        <me>
          x = s + 2 t \ \ \ \ \ \text{ and }  \ \ \ \ \ y = 2 s + \sqrt{t}.
        </me>
      </p>

      <p>
        Let's see what happens to the rectangle <m>T = [0,1] \times [1,4]</m> in the <m>st</m>-plane under this change of variable.
        <ol marker="a.">
          <li>
            <p>
              Draw a labeled picture of <m>T</m> in the <m>st</m>-plane.
            </p>
          </li>

          <li>
            <p>
              Find the image of the <m>st</m>-vertex <m>(0,1)</m> in the <m>xy</m>-plane.  Likewise, find the respective images of the other three vertices of the rectangle <m>T</m>: <m>(0,4)</m>, <m>(1,1)</m>, and <m>(1,4)</m>.
            </p>
          </li>

          <li>
            <p>
              In the <m>xy</m>-plane, draw a labeled picture of the image, <m>T'</m>, of the original <m>st</m>-rectangle <m>T</m>. What appears to be the shape of the image, <m>T'</m>?
            </p>
          </li>

          <li>
            <p>
              To transform an integral with a change of variables,  we need to determine the area element <m>dA</m> for image of the  transformed rectangle. Note that <m>T'</m> is not exactly a parallelogram since the equations that define the transformation are not linear. But we can approximate the area of <m>T'</m> with the area of a parallelogram. How would we find the area of a parallelogram that approximates the area of the <m>xy</m>-figure <m>T'</m>? (Hint: Remember what the cross product of two vectors tells us.)
            </p>
          </li>
        </ol>
      </p>
      </statement>
      <solution>
        <ul>
          <li>
            <p>
              A picture of the rectangle <m>T</m> is shown in the image below.
            </p>
          </li>
          <li>
            <p>
              The <m>st</m>-vertex <m>(0,1)</m> gets sent to the point
              <m>(0+2(1), 2(0)+\sqrt{1}) = (2,1)</m> in the <m>xy</m>-plane,
            </p>
          </li>
          <li>
            <p>
              The point <m>(0,4)</m> in the <m>st</m>-plane gets sent to the point <m>(8,2)</m> in the <m>xy</m>-plane.
              The point <m>(1,1)</m> in the <m>st</m>-plane gets sent to the point <m>(3,3)</m> in the <m>xy</m>-plane.
              The point <m>(1,4)</m> in the <m>st</m>-plane gets sent to the point <m>(9,4)</m> in the <m>xy</m>-plane.
            </p>
          </li>
          <li>
            <p>
              The image <m>T'</m> of <m>T</m> is not a rectangle in the <m>xy</m>-plane because the change of variable formulas are not linear.
              The image <m>T'</m> looks like a parallelogram.
            </p>
          </li>
          <li>
            <p>
              The area of <m>T'</m> is the area of a parallelogram,
              which we can find with a cross product.
              The sides of the parallelogram can be viewed as the vectors
              <m>\vu = \langle 1, 2, 0\rangle</m> and <m>\vv = \langle 6, 1, 0 \rangle</m>.
              The area of the parallelogram is then <m>|\vu \times \vv|</m>.
            </p>
          </li>
        </ul>
        <p>
          <image width="73%" source="images/11_9_Act_1a" />
        </p>
      </solution>
    </activity>
</worksheet> -->
    <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_1">
      <introduction>
        <p>
          In this activity, we will be looking at what happens to the region <m>D</m>, as shown in <xref ref="irreg-region"/>, under the change of coordinates given by 
          <me>x=\sqrt{st} \quad \text{ and } \quad y =\sqrt{\frac{s}{t}}</me>
        </p>
        <figure xml:id="irreg-region">
          <caption></caption>
          <image width="60%" xml:id="img-irreg-region">
            <sageplot>
              var('t,s,x,y')
              plot7=plot(2*x,(x,0,3),color="black",thickness=2)+text("$y=2x$",(1.5,2.4),color="black",fontsize=20)
              plot7+=plot(x/2,(x,0,3),color="black",thickness=2)+text("$y=\\frac{x}{2}$",(2.25,1.4),color="black",fontsize=20)
              plot7+=plot(2/x,(x,0,3),color="black",thickness=2)+text("$y=\\frac{2}{x}$",(2.2,0.7),color="black",fontsize=20)
              plot7+=plot(1/(2*x),(x,0,3),color="black",thickness=2)+text("$y=\\frac{1}{2x}$",(1.5,0.5),color="black",fontsize=20)
              points=[(1/2+i/25*(1/2),1/(2*(1/2+i/25*(1/2)))) for i in range(26)]
              points2=[(2-i/25,2/(2-i/25)) for i in range(26)]
              points=points+points2
              plot7+=polygon(points,color="gray")+text("$D$",(1.1,1.1),color="black",fontsize=25,xmin=0,xmax=2.5,ymin=0,ymax=2.5)
              plot7                  
            </sageplot>
          </image>
        </figure>
      </introduction>
      <task>
        <statement>
          <p>
            Find the coordinates of the four corner points of the region <m>D</m>. 
          </p>
        </statement>
        <solution>
          <p>
            The corner points are <m>(x,y)= (\frac{1}{2},1) , (1,\frac{1}{2}), (2,1), (1,2)</m>
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Given the form of the change of variable equations above, it is not obvious how to change <m>(x,y)</m> points into <m>(s,t)</m> points. Show that the following equations are satisfied by our change of variable equations:
            <me>yx=s \quad \text{and} \quad \frac{y}{x}=\frac{1}{t}</me>
            Use these new relationships between our coordinates to convert each of these four corner points from <m>xy</m>-coordinates to <m>st</m>-coordinates and draw these points on <xref ref="st-plane1"/>.
          </p>
          <figure xml:id="st-plane1">
            <caption></caption>
            <image width="60%" xml:id="img-st-plane1">
              <sageplot>
                plot8=point((0,0),size=0,color="black",xmin=0,xmax=2.5,ymin=0,ymax=2.5,gridlines=True,axes_labels=["$s$","$t$"],aspect_ratio=1)
                plot8                  
              </sageplot>
            </image>
          </figure>
        </statement>
        <solution>
          <p>
            Substituting in our change of variable equations into the the expressions <m>yx</m> and <m>\frac{y}{x}</m> gives the following:
            <md>
              <mrow>yx = \sqrt{st} \sqrt{\frac{s}{t}}= s </mrow>
              <mrow>\frac{y}{x}=\frac{\sqrt{\frac{s}{t}}}{\sqrt{st}} = \frac{1}{t}</mrow>
            </md>
            By taking the appropriate product or ratio of <m>x</m> and <m>y</m> coordinates, we get the <m>(s,t)</m> coordinates of <m>(s,t)= (\frac{1}{2},\frac{1}{2}) , (2,\frac{1}{2}), (2,2), (\frac{1}{2},2)</m>
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            We hope that the curved boundaries of the region <m>D</m> get transformed to horizontal and vertical lines in the <m>st</m>-plane, as is suggested by the result of the previous task. Let's look at how each of the boundary curves gets transformed by our change of variables formula.
          </p>
          <p>
            Use the change of variables equations to write <m> y=2x</m> in terms of <m>s</m> and <m>t</m> coordinates and solve for either <m>s</m> or <m>t</m> (as would make sense). Plot the resulting line on <xref ref="st-plane1"/>.
          </p>
        </statement>
        <solution>
          <p>
            Notice that because <m>\frac{y}{x}=\frac{\sqrt{\frac{s}{t}}}{\sqrt{st}} = \frac{1}{t}</m>, then <m>y=2x</m> goes to <m>t=\frac{1}{2}</m>
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Write each of the other boundary curves of <m>D</m> (<m>y=\frac{2}{x}, y=\frac{1}{2x}, y=\frac{x}{2}</m>) in terms of <m>s</m> and <m>t</m> coordinates, solve for either <m>s</m> or <m>t</m> (as would make sense), and plot the resulting lines on <xref ref="st-plane1"/>. 
          </p>
        </statement>
        <solution>
          <p>
            Notice that because <m>\frac{y}{x}=\frac{\sqrt{\frac{s}{t}}}{\sqrt{st}} = \frac{1}{t}</m> and <m>yx = \sqrt{st} \sqrt{\frac{s}{t}}= s</m>, then <m>y=\frac{x}{2}</m> goes to <m>t=2</m>, <m>y=\frac{2}{x}</m> goes to <m>s=2</m>, and <m>y=\frac{1}{2x}</m> goes to <m>t=\frac{1}{2}</m>.
          </p>
          <image>
            <sageplot>
              plot9=polygon([(1/2,1/2),(1/2,2),(2,2),(2,1/2)],color="gray",edgecolor="black",thickness=2,xmin=0,xmax=3,ymin=0,ymax=3,gridlines=True,axes_labels=["$s$","$t$"],aspect_ratio=1)
              plot9+=point([(1/2,1/2),(1/2,2),(2,2),(2,1/2)],color="black",size=30)
              plot9
            </sageplot>
          </image>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            We have now confirmed that our irregular region <m>D</m> gets mapped to a rectangle in the <m>st</m>-plane by the change of variables formula given. Some areas of the region <m>D</m> needed to be stretched more than others in order to straighten out our sides into the nice rectangle you have drawn on <xref ref="st-plane1"/>. Write a few sentences to describe what part of <m>D</m> you think is stretched the most in the transformation from <m>xy</m>-coordinates to <m>st</m>-coordinates. 
          </p>
        </statement>
        <solution>
          <p>
            Each of the boundary curves gets transformed to a side of a square with length 1.5 but the boundary given by <m>y=\frac{1}{2x}</m> has the shortest length of the sides of <m>D</m>. So the lower left side of <m>D</m>, nearest the boundary given by <m>y=\frac{1}{2x}</m> must have been stretched the most in the transformation from <m>xy</m>-coordinates to <m>st</m>-coordinates. 
          </p>
        </solution>
      </task>
    </activity>
</worksheet>
    <p>
      In <xref ref="A_11_9_1">Activity</xref>, we used a clever relationship to convert our corner points from <m>xy</m>-coordinates to <m>st</m>-coordinates, but in general you would need to solve a system of equations to find the corresponding <m>(s,t)</m> points. For example, if we have change of coordinate equations given by <m>x=3s-2t</m> and <m> y =s+4t</m>, then the transformation of the point <m>(x,y)=(1,2)</m>, would come from solving the system of equations <m>1= 3s-2t</m> and <m> 2 =s+4t</m>.
    </p>
    <p>
      If we shift our attention to the area element associated with a change of variables, we will need to look at how the area is stretched by the transformation between <m>xy</m>-coordinates to <m>st</m>-coordinates. Conceptually, derivatives will allow us to measure how quickly coordinates are changing in the context of a change of variables. Let's look back at the single variable example stated in the introduction to this section. 
    </p>
    <example>
      <p>
        If we look at the integral
        <me>
          \int_0^2 2x(x^2+1)^3\, dx,
        </me>
        and consider the change of variable <m>u = x^2+1</m> with <m>du = 2x \, dx</m>, then <m>x = 0</m> implies <m>u = 1</m> and <m>x = 2</m> implies <m>u = 5</m>. So we have transformed the original integral in <m>x</m> into a new integral in <m>u</m>. In particular,
        <me>
          \int_0^2 (x^2+1)^3 (2x\, dx) = \int_1^5 u^3 \, du
        </me>
        which we can visualize with the following plots of area under curves.
      </p>
      <sidebyside widths="45% 45%">
        <figure xml:id="int1Dx">
          <image width="60%" xml:id="img-int1Dx">
            <sageplot>
              var('t,s,x,y')
              f(x)=2*x*(x^2+1)^3
              n=100
              points=[(i*2/n,f(i*2/n)) for i in range(n+1)]
              points+=[(2,0)]
              plot1=plot(f(x),(x,0,2),color="black",thickness=2,gridlines=True,axes_labels=["$x$","$f(x)=2x(x^2+1)^3$"])
              plot1+=polygon(points, color="gray",edgecolor="black",aspect_ratio=3/500,xmin=-0.5,xmax=2.5)
              plot1                  
            </sageplot>
          </image>
        </figure>
        <figure xml:id="int1Du">
          <image width="60%" xml:id="img-int1Du">
            <sageplot>
              var('t,s,x,y')
              f(x)=x^3
              n=100
              points=[(i*4/n+1,f(i*4/n+1)) for i in range(n+1)]
              points+=[(5,0),(1,0)]
              plot2=plot(f(x),(x,1,5),color="black",thickness=2,gridlines=True,axes_labels=["$u$","$g(u)=u^3$"])
              plot2+=polygon(points, color="gray",edgecolor="black",aspect_ratio=5.5/125,xmin=0,xmax=5.5)
              plot2                  
            </sageplot>
          </image>
        </figure>
      </sidebyside>
      <p>
        Both of these shaded regions have the same area but you can see that the scales on the vertical and horizontal axes changed. The vertical axis on each graph corresponds to the output of the function being integrated and the transformation comes from transforming the integrand. The bounds on the integral come from the conversion of the interval <m>[0,2]</m> in <m>x</m>-coordinates to the interval <m>[1,5]</m> in <m>u</m>-coordinates. The final part of this substitution/change of variable problem is converting the differential. 
      </p>
    </example>
    <p>
      We have seen how in a two dimensional setting, we can convert the region of integration (<xref ref="A_11_9_1">Activity</xref>) and the integrand (the function being integrated) using our change of variable equations. As was suggested by the previous example, the partial derivatives of <m>x</m> and <m>y</m> with respect to <m>s</m> or <m>t</m> will measure how each variable (<m>x</m> or <m>y</m>) is stretched with respect to small a small change in the inputs (<m>s</m> or <m>t</m>). We will need to use vectors to quantify how these individual coordinate changes will amount to changes in the way we measure area. 
    </p>
    <p>
      The following result summarizes how to find the area element corresponding to a change of variables in general. We have included the details of the vector argument as a proof to this result. 
    </p>
    <proposition xml:id="prop-area-cov">
      <statement>
        <p>
          Given a change of coordinates given by <m>x=x(s,t) </m> and <m>y=y(s,t)</m>, the associated area element is given by <m>dA = dy \, dx = \left| \frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}\right| \, ds \, dt</m>.
        </p>     
      </statement>
      <proof>
        <p>
          We partition a rectangular domain in the <m>st</m> system into subrectangles. Let <m>T = [a, b] \times [a+\Delta s, b+\Delta t]</m> be one of these subrectangles. Then we transform this into a region <m>T'</m> in the standard <m>xy</m> Cartesian coordinate system. The region <m>T'</m> is called the <em>image</em> of <m>T</m>; the region <m>T</m> is the <em>pre-image</em> of <m>T'</m>. Although the sides of this <m>xy</m> region <m>T'</m> aren't necessarily straight (linear), we will approximate the element of area <m>dA</m> for this region with the area of the parallelogram whose sides are given by the vectors <m>\vv</m> and <m>\vw</m>, where <m>\vv</m> is the vector from <m>(x(a, b), y(a, b))</m> to <m>(x(a + \Delta s, b), y(a + \Delta s, b))</m>, and <m>\vw</m> is the vector from <m>(x(a, b), y(a, b))</m> to <m>(x(a, b + \Delta t), y(a, b + \Delta t))</m>.
        </p>

        <p>
          An example of an image <m>T'</m> in the <m>xy</m>-plane that results from a transformation of a rectangle <m>T</m> in the <m>st</m>-plane is shown in <xref ref="F_11_9_Change_vars_ex">Figure</xref>.
        </p>

        <!-- <figure xml:id="F_11_9_Change_vars_ex">
          <caption>Approximating an area of an image resulting from a transformation.</caption>
          <image width="100%" source="images/fig_11_9_general_change"/>
        </figure> -->
        <figure xml:id="F_11_9_Change_vars_ex">
          <caption>Approximating an area of an image resulting from a transformation</caption>
          <sidebyside widths="45% 45%">
            <image>
              <sageplot>
                from matplotlib import ticker
                plot10=polygon([(.5,.5),(1,.5),(1,1),(.5,1)],color="gray",edgecolor="black",thickness=2,xmin=0,xmax=2,ymin=0,ymax=2,axes_labels=["$s$","$t$"],gridlines=True,tick_formatter=(ticker.NullFormatter(),
                ticker.NullFormatter()))
                plot10+=text("$\\Delta s$",(0.75,0.4),fontsize=20,color="black")
                plot10+=text("$\\Delta t$",(0.4,0.75),fontsize=20,color="black")
                plot10
              </sageplot>
            </image>
            <image>
              <sageplot>
                from matplotlib import ticker
                plot11=polygon([(.7,.6),(1.5,1.0),(1.1,1.5),(.3,1.1)],color="lightblue",edgecolor="black",thickness=2,xmin=0,xmax=2,ymin=0,ymax=2,axes_labels=["$x$","$y$"],gridlines=True,tick_formatter=(ticker.NullFormatter(),
                ticker.NullFormatter()))
                plot11+=arrow((.7,.6),(1.5,1.0),color="red")
                plot11+=arrow((.7,.6),(.3,1.1),color="blue")
                plot11+=text("$\\vec{v}$",(0.95,0.6),fontsize=20,color="red")
                plot11+=text("$\\vec{w}$",(0.4,0.75),fontsize=20,color="blue")
                plot11
              </sageplot>
            </image>
          </sidebyside>
        </figure>
        <p>
          The components of the vector <m>\vv</m> are
          <md>
            <mrow>\vv \amp = \left\langle x(a+ \Delta s, b) - x(a,b), y(a+ \Delta s, b) - y(a,b), 0 \right\rangle</mrow>
          </md>
          and for <m>\vw</m> the components are
          <md>
            <mrow>\vw \amp = \left\langle x(a, b+ \Delta t) - x(a,b), y(a, b+ \Delta s) - y(a,b), 0 \right\rangle.</mrow>
          </md>
        </p>

        <p>
          Slightly rewriting <m>\vv</m> and <m>\vw</m>, we have
          <md>
            <mrow>\vv \amp = \left\langle \frac{x(a+ \Delta s, b) - x(a,b)}{\Delta s}, \frac{y(a+ \Delta s, b) - y(a,b)}{\Delta s}, 0 \right\rangle \Delta s, \ \mbox{and}</mrow>
            <mrow>\vw \amp = \left\langle \frac{x(a, b+ \Delta t) - x(a,b)}{\Delta t}, \frac{y(a, b+ \Delta s) - y(a,b)}{\Delta t}, 0 \right\rangle \Delta t.</mrow>
          </md>
        </p>

        <p>
          For small <m>\Delta s</m> and <m>\Delta t</m>, the definition of the partial derivative tells us that
          <me>
            \vv \approx \left\langle \frac{\partial x}{\partial s}(a,b), \frac{\partial y}{\partial s}(a,b), 0 \right\rangle \Delta s \ \ \ \ \ \text{ and }  \ \ \ \ \  \vw \approx \left\langle \frac{\partial x}{\partial t}(a,b), \frac{\partial y}{\partial t}(a,b), 0 \right\rangle \Delta t.
          </me>
        </p>

        <p>
          Recall that the area of the parallelogram with sides <m>\vv</m> and <m>\vw</m> is the length of the cross product of the two vectors, <m>|\vv \times \vw|</m>. From this, we observe that
          <md>
            <mrow>\vv \times \vw \amp \approx \left\langle \frac{\partial x}{\partial s}(a,b), \frac{\partial y}{\partial s}(a,b), 0 \right\rangle \Delta s \times \left\langle \frac{\partial x}{\partial t}(a,b), \frac{\partial y}{\partial t}(a,b), 0 \right\rangle \Delta t</mrow>
            <mrow>\amp = \left\langle 0, \ 0, \ \frac{\partial x}{\partial s}(a,b) \frac{\partial y}{\partial t}(a,b) - \frac{\partial x}{\partial t}(a,b) \frac{\partial y}{\partial s}(a,b) \right\rangle \Delta s \, \Delta t.</mrow>
          </md>
        </p>

        <p>
          Finally, by computing the magnitude of the cross product, we see that
          <md>
            <mrow>|\vv \times \vw| \amp \approx \left|\left\langle 0,0, \frac{\partial x}{\partial s}(a,b) \frac{\partial y}{\partial t}(a,b) - \frac{\partial x}{\partial t}(a,b) \frac{\partial y}{\partial s}(a,b) \right\rangle \Delta s \, \Delta t\right|</mrow>
            <mrow>\amp = \left|\frac{\partial x}{\partial s}(a,b) \frac{\partial y}{\partial t}(a,b) - \frac{\partial x}{\partial t}(a,b) \frac{\partial y}{\partial s}(a,b)\right| \Delta s \, \Delta t.</mrow>
          </md>
        </p>

        <p>
          Therefore, as the number of subdivisions increases without bound in each direction, <m>\Delta s</m> and <m>\Delta t</m> both go to zero, and we have
          <men xml:id="E_Area_Element">
            dA = \left|\frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s} \right| ds \, dt.
          </men>
        </p>
      </proof>
    </proposition>
    <p>
      <xref ref="prop-area-cov"/> determines the general change of variable formula in a double integral, and we can now convert all the parts of the double integral to <m>s</m> and <m>t</m> coordinates.
      <me>
        \iint_T f(x,y) \, dy \, dx = \iint_{T'} f(x(s,t),y(s,t)) \left|\frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}\right| ds \, dt
      </me>
    </p>

    <p>
      The quantity
      <me>
        \frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}
      </me>
      is called the <em>Jacobian</em><idx><h>Jacobian</h></idx>, and we denote the Jacobian using the shorthand notation
      <me>
        \frac{\partial (x,y)}{\partial (s,t)}  =  \frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}.
      </me>
      Recall from <xref ref="S-Precalc-CrossProduct">Section</xref> that we can also write this Jacobian as the determinant of the <m>2 \times 2</m> matrix <m>\left[ \begin{array}{cc} \frac{\partial x}{\partial s} \amp  \frac{\partial x}{\partial t}  \\ \frac{\partial y}{\partial s} \amp  \frac{\partial y}{\partial t} \end{array}  \right] </m>. Note that, as discussed in <xref ref="S-Precalc-CrossProduct">Section</xref>, the absolute value of the determinant of <m>\left[ \begin{array}{cc} \frac{\partial x}{\partial s} \amp  \frac{\partial x}{\partial t}  \\ \frac{\partial y}{\partial s} \amp  \frac{\partial y}{\partial t} \end{array}  \right]</m> is the area of the parallelogram determined by the vectors <m>\vv</m> and <m>\vw</m>, and so the area element <m>dA</m> in <m>xy</m>-coordinates is also represented by the area element <m>\left| \frac{\partial (x,y)}{\partial (s,t)} \right| \, ds \, dt</m> in <m>st</m>-coordinates, and <m>\left| \frac{\partial (x,y)}{\partial (s,t)} \right|</m> is the factor by which the transformation magnifies area. 
    </p>
    <example>
      <p>
        We will look at the Jacobian for the change of variables in <xref ref="A_11_9_1"/>. Given 
        <me>x=\sqrt{st} \quad \text{ and } \quad y =\sqrt{\frac{s}{t}}</me>
        we will need to find the partial derivatives of these with respect to both <m>s</m> and <m>t</m>. 
        <md>
          <mrow>\frac{\partial x}{\partial s} \amp= \sqrt{t} \left(\frac{1}{2} \frac{1}{\sqrt{s}}\right) \amp= \frac{1}{2} \sqrt{\frac{t}{s}} </mrow>
          <mrow>\frac{\partial x}{\partial t} \amp= \sqrt{s} \left(\frac{1}{2} \frac{1}{\sqrt{t}}\right) \amp= \frac{1}{2} \sqrt{\frac{s}{t}} </mrow>
          <mrow>\frac{\partial y}{\partial s} \amp= \sqrt{\frac{1}{t}} \left(\frac{1}{2} \frac{1}{\sqrt{s}}\right) \amp= \frac{1}{2} \sqrt{\frac{1}{st}} </mrow>
          <mrow>\frac{\partial y}{\partial t} \amp= \sqrt{s} \left(-\frac{1}{2} \frac{1}{\sqrt{t^3}}\right) \amp= -\frac{1}{2} \sqrt{\frac{s}{t^3}} </mrow>
        </md>
        The Jacobian will then be
        <me>
          det \left(\left[ \begin{array}{cc} \frac{\partial x}{\partial s} \amp  \frac{\partial x}{\partial t}  \\ \frac{\partial y}{\partial s} \amp  \frac{\partial y}{\partial t} \end{array}  \right] \right)
          = det \left(\left[ \begin{array}{cc} \frac{1}{2} \sqrt{\frac{t}{s}}  \amp  \frac{1}{2} \sqrt{\frac{s}{t}}  \\ \frac{1}{2} \sqrt{\frac{1}{st}} \amp  -\frac{1}{2} \sqrt{\frac{s}{t^3}} \end{array}  \right] \right)
        </me>
        which will evaluate to 
        <me>
          \left(\frac{1}{2} \sqrt{\frac{t}{s}} \right)\left(-\frac{1}{2} \sqrt{\frac{s}{t^3}} \right) - \left(\frac{1}{2} \sqrt{\frac{s}{t}} \right) \left(\frac{1}{2} \sqrt{\frac{1}{st}} \right) = -\frac{1}{2t}
        </me>
      </p>
      <p>
        It is important to note a couple of interesting features of our Jacobian. First, the Jacobian is negative because in this example the region is flipped; Specifically the <q>lower</q> and <q>upper</q> bounds in <xref ref="irreg-region"/> given by <m>y=\frac{x}{2}</m> and <m>y=2x</m> are respectively transformed to <m>t=2</m> and <m>t=\frac{1}{2}</m>. In other words, the top and bottom edges get flipped by the transformation which results in this area transformation being negative. Notice that we take the absolute value of the Jacobian when considering the area element because we only care about how the area is deformed in the transformation given by the change of coordinates (and do not care about any flips that occur as part of the transformation).
      </p>
      <p>
        The second feature is that the Jacobian is not constant, which means that the deformation of the area does not occur the same at every part of our region. In particular, for values where <m>t</m> is great than one, we are multiplying by a smaller factor, which means the region is expanded as part of the transformation from <m>xy</m> to <m>st</m> coordinates. For values where <m>t</m> is less than one, we are multiplying by a larger factor, which means the region is shrunk as part of the transformation from <m>xy</m> to <m>st</m> coordinates. 
      </p>
    </example>  

    <p>
      To summarize our work on change of variables and double integrals, the preceding change of variable formula we have derived is stated here.
    </p> 

    <assemblage xml:id="Change-of-variable">
      <title>Change of Variables in a Double Integral<idx><h>change of variable</h><h>double integral</h></idx></title>
      <p>
        Suppose a change of variables <m>x = x(s,t)</m> and <m>y = y(s,t)</m> transforms a closed and bounded region <m>R</m> in the <m>st</m>-plane into a closed and bounded region <m>R'</m> in the <m>xy</m>-plane. Under modest conditions (that are studied in advanced calculus), it follows that
        <me>
          \iint_{R'} f(x,y) \, dA = \iint_{R} f(x(s,t), y(s,t)) \left|\frac{\partial (x,y)}{\partial (s,t)}\right| \, ds \, dt.
        </me>
      </p>
    </assemblage>

    <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_2">
      <introduction>
        <p>
          In this activity, we will look at a few familiar Jacobians and their interpretations. 
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            Find the Jacobian for the transformation given by <m>x=3s-1</m> and <m>y=\frac{t}{3}+2</m>. Write a couple of sentences about why the area of a region will not change with respect to this change of coordinates.
          </p>
        </statement>
        <solution>
          <p>
            The non-zero partial derivatives will be <m>\frac{\partial x}{\partial s}= 3</m> and <m>\frac{\partial y}{\partial t}= \frac{1}{3}</m> which gives a Jacobian of 1. The transformation from <m>xy</m> to <m>st</m> corresponds to a horizontal stretch by a factor of three and a vertical contraction (by a factor of <m>\frac{1}{3}</m>), so the area would not change. The shifts in the coordinates <m>xy</m> to <m>st</m> of -1 and +2 will not affect the area of the region.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Find the Jacobian when changing from rectangular to polar coordinates. Write a couple of sentences to connect to our work on double integrals in polar coordinates.
          </p>
        </statement>
        <solution>
          <p>
            In this case we have
            <me>
              x(r, \theta) = r \cos(\theta) \ \ \ \ \ \text{ and }  \ \ \ \ \ y(r, \theta) = r \sin(\theta)
            </me>.
          </p>
          <p>
            Since we can assume <m>r \geq 0</m> in polar coordinates,
            the Jacobian is
            <me>
              \left|\frac{\partial x}{\partial r} \frac{\partial y}{\partial \theta} - \frac{\partial x}{\partial \theta} \frac{\partial y}{\partial r}\right| = \left|\cos(\theta)(r\cos(\theta)) - \sin(\theta)(r\sin(\theta))\right| = \left|r\cos^2(\theta) + r\sin^2(\theta)\right| = r
            </me>
            as expected.
          </p>
        </solution>
      </task>
    </activity>
</worksheet>

    <p>
      Given a particular double integral, it is natural to ask, <q>how can we find a useful change of variables?</q> There are two general factors to consider: if the integrand is particularly difficult, we might choose a change of variables that would make the integrand easier; or, given a complicated region of integration, we might choose a change of variables that transforms the region of integration into one that has a simpler form. These ideas are illustrated in the next activities.
    </p>
    <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_3">
      <introduction>
        <p>
          Consider the problem of finding the area of the region <m>D'</m> defined by the ellipse <m>x^2 + \frac{y^2}{4} = 1</m>. In this activity, we will look at what happens when we use a change of variables so that the pre-image of the domain is a circle.
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            Let <m>x(s,t) = s</m> and <m>y(s,t) = 2t</m>. Explain why the pre-image of the original ellipse (which lies in the <m>xy</m> plane) is the circle <m>s^2 + t^2 = 1</m> in the <m>st</m>-plane.
          </p>
        </statement>
        <solution>
          <p>
            Substituting <m>s</m> for <m>x</m> and <m>2t</m> for <m>y</m> in our ellipse equation gives us
            <me>
              1 = x^2 + \frac{y^2}{4} = s^2 + \frac{(2t)^2}{4} = s^2 + t^2
            </me>.
            So the pre-image of the the ellipse in the <m>st</m>-plane is the circle <m>s^2 + t^2 = 1</m>.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Recall that the area of the ellipse <m>D'</m> is determined by the double integral <m> \iint_{D'} 1 \, dA</m>. Explain why
            <me>
              \iint_{D'} 1 \, dA = \iint_{D} 2 \, ds \, dt
            </me>
            where <m>D</m> is the disk bounded by the circle <m>s^2 + t^2 = 1</m>. In particular, explain the source of the <q>2</q> in the <m>st</m> integral.
          </p>
        </statement>
        <solution>
          <p>
            This is just asking us to find the Jacobian
            <me>
              \left|\frac{\partial(x,y)}{\partial(s,t)}\right| = \left|\frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}\right| = |(1)(2) - (0)(0)| = 2
            </me>.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Without evaluating any of the integrals present, explain why the area of the original elliptical region <m>D'</m> is <m>2\pi</m>.
          </p>
        </statement>
        <solution>
          <p>
            We know that <m>D'</m> is a circle of radius 1 and so has area <m>\pi</m>.Therefore,
            <me>
            \iint_D 1 \, dA = \iint_{D'} 2 \, ds \, dt = 2\iint_{D'}  \, ds \, dt = 2\pi
            </me>.
          </p>
        </solution>
      </task>
    </activity>
</worksheet>

    <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_4">
      <introduction>
        <p>
          Let <m>D'</m> be the region in the <m>xy</m>-plane bounded by the lines <m>y=0</m>, <m>x=0</m>, and <m>x+y=1</m>. We will evaluate the double integral
        <men xml:id="eq_11_9_COV_ex">
          \iint_{D'} \sqrt{x+y}(x-y)^2 \, dA
        </men>
        with a change of variables.
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            Sketch the region <m>D'</m> in the <m>xy</m>-plane.
          </p>
        </statement>
        <solution>
          <p>
            A sketch of the <m>xy</m> domain <m>D'</m> is shown below.
          </p>
          <image width="73%" source="images/11_9_Act_4"/>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            We would like to make a substitution that makes the integrand easier to antidifferentiate. Let <m>s = x+y</m> and <m>t = x-y</m>. Explain why this should make antidifferentiation easier by making the corresponding substitutions and writing the new integrand in terms of <m>s</m> and <m>t</m>.
          </p>
        </statement>
        <solution>
          <p>
            This change of variable would make the integrand look like <m>\sqrt{s}t^2</m>, which separates the variables and makes the integration easier.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Solve the equations <m>s = x+y</m> and <m>t = x-y</m> for <m>x</m> and <m>y</m>. (Doing so determines the standard form of the transformation, since we will have <m>x</m> as a function of <m>s</m> and <m>t</m>, and <m>y</m> as a function of <m>s</m> and <m>t</m>.)
          </p>
        </statement>
        <solution>
          <p>
            A little algebra shows that <m>x = \frac{1}{2}(s+t)</m> and <m>y = \frac{1}{2}(s-t)</m>.
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            To actually execute this change of variables, we need to know the <m>st</m>-region <m>D</m> that corresponds to the <m>xy</m>-region <m>D'</m>.
            <ol marker="i.">
              <li> What <m>st</m> equation corresponds to the <m>xy</m> equation <m>x+y=1</m>? </li>
              <li>  What <m>st</m> equation corresponds to the <m>xy</m> equation <m>x=0</m>? </li>
              <li>  What <m>st</m> equation corresponds to the <m>xy</m> equation <m>y=0</m>? </li>
              <li> Sketch the <m>st</m> region <m>D</m> that corresponds to the <m>xy</m> domain <m>D'</m>. </li>
            </ol>
          </p>
        </statement>
        <solution>
          <p>
            To make this change of variables, we will need to know the <m>st</m>-region <m>S</m> that corresponds to the <m>xy</m>-region <m>D</m>.
            <ol marker="i">
              <li> Using our change of variables we have
                  <me>
                    1 = x+y = \frac{1}{2}((s+t)+(s-t)) = s
                  </me> </li>
              <li> Using our change of variables we have
                  <me>
                    0 = x = \frac{1}{2}(s+t)
                  </me>
                  or
                  <me>
                    s+t = 0
                  </me>.
              </li>
              <li> Using our change of variables we have
                  <me>
                    0 = y = \frac{1}{2}(s-t)
                  </me>
                  or
                  <me>
                    s-t = 0
                  </me>.
              </li>
              <li> The region <m>D</m> is shown below. </li>
            </ol>
          </p>
        </solution>
      </task>
      <task>
        <statement>
          <p>
            Make the change of variables indicated by <m>s = x+y</m> and <m>t = x-y</m> in the double integral <xref ref="eq_11_9_COV_ex"/> and set up an iterated integral in <m>st</m> variables whose value is the original given double integral. Finally, evaluate the iterated integral.
          </p>
        </statement>
        <solution>
          <p>
            We need the Jacobian
            <me>
              \left|\frac{\partial(x,y)}{\partial(s,t)}\right| = \left|\frac{\partial x}{\partial s} \frac{\partial y}{\partial t} - \frac{\partial x}{\partial t} \frac{\partial y}{\partial s}\right| = \left| \left(\frac{1}{2}\right)\left(-\frac{1}{2}\right) - \left(\frac{1}{2}\right)\left(\frac{1}{2}\right)\right| = \frac{1}{2}
            </me>.
            Then
            <md>
              <mrow>\iint_D \sqrt{x+y}(x-y)^2 \, dA \amp = \iint_S \sqrt{s}t^2 \left|\frac{\partial(x,y)}{\partial(s,t)}\right| \, ds \, dt</mrow>
              <mrow>\amp = \int_0^1 \int_{-s}^{s} \sqrt{s}t^2 \frac{1}{2} \, dt \, ds</mrow>
              <mrow>\amp = \frac{1}{2} \int_0^1 \left. \sqrt{s} \frac{t^3}{3} \restrict{-s}^{s} \, ds</mrow>
              <mrow>\amp = \frac{1}{3} \int_0^1 \sqrt{s}s^3 \, ds</mrow>
              <mrow>\amp = \frac{1}{3} \int_0^1 s^{7/2} \, ds</mrow>
              <mrow>\amp = \frac{2}{27} \left. s^{9/2} \restrict0^1</mrow>
              <mrow>\amp = \frac{2}{27}</mrow>
            </md>
          </p>
        </solution>
      </task>
    </activity>
</worksheet>
  </subsection>


  <subsection>
    <title>Change of Variables in a Triple Integral</title>

    <p>
     The details of an argument for the change of variable formula for triple integrals are more complicated the two dimension case we have just discussed and we omit those here. The general process, though, is the same as the two-dimensional case; Namely, we will use partial derivatives and the determinant of a matrix of the partial derivatives to give the appropriate volume element for the new coordinate. 
    </p>
    <p>
      Given a solid <m>S'</m> in the <m>xyz</m>-coordinate system in <m>\R^3</m>, a change of variables transformation <m>x=x(s,t,u)</m>, <m>y=y(s,t,u)</m>, and <m>z = z(s,t,u)</m> transforms <m>S'</m> into a region <m>S</m> in <m>stu</m>-coordinates. Any function <m>f = f(x,y,z)</m> defined on <m>S'</m> can be considered as a function <m>f = f(x(s,t,u), y(s,t,u), z(s,t,u))</m> in <m>stu</m>-coordinates defined on <m>S</m>. The volume element <m>dV</m> in <m>xyz</m>-coordinates cooresponds to a scaled volume element in <m>stu</m>-coordinates, where the scale factor is given by the absolute value of the Jacobian, <m>\frac{\partial(x,y,z)}{\partial(s,t,u)}</m>, which is the determinant of the <m>3 \times 3</m> matrix
      <me>
        \left[ \begin{array}{ccc} \frac{\partial x}{\partial s} \amp  \frac{\partial x}{\partial t} \amp  \frac{\partial x}{\partial u} \\ \frac{\partial y}{\partial s} \amp  \frac{\partial y}{\partial t} \amp  \frac{\partial y}{\partial u} \\ \frac{\partial z}{\partial s} \amp  \frac{\partial z}{\partial t} \amp  \frac{\partial z}{\partial u} \end{array}  \right]
      </me>. 
      (Recall that this determinant was introduced in <xref ref="S-Precalc-CrossProduct">Section</xref>.) That is, <m>\frac{\partial(x,y,z)}{\partial(s,t,u)}</m> is given by  
       <me>
        \frac{\partial x}{\partial s}\left[\frac{\partial y}{\partial t}\frac{\partial z}{\partial u} - \frac{\partial y}{\partial u}\frac{\partial z}{\partial t}\right] - \frac{\partial x}{\partial t}\left[\frac{\partial y}{\partial s}\frac{\partial z}{\partial u} - \frac{\partial y}{\partial u}\frac{\partial z}{\partial s}\right] + \frac{\partial x}{\partial u}\left[\frac{\partial y}{\partial s}\frac{\partial z}{\partial t} - \frac{\partial y}{\partial t}\frac{\partial z}{\partial s}\right].
      </me>
    </p>
    
    <assemblage xml:id="Change-of-variable-3D">
      <title>Change of Variables in a Triple Integral<idx><h>change of variable</h><h>triple integral</h></idx></title>
      <p>
        Suppose a change of variables <m>x = x(s,t,u)</m>, <m>y = y(s,t,u)</m>, and <m>z = z(s,t,u)</m> transforms a closed and bounded region <m>S</m> in <m>stu</m>-coordinates into a closed and bounded region <m>S'</m> in <m>xyz</m>-coordinates. Under modest conditions (that are studied in advanced calculus), the triple integral <m>\iiint_{S'} f(x,y,z) \, dV </m> is equal to 
        <me>
          \iiint_{S} f(x(s,t,u),y(s,t,u),z(s,t,u)) \ \left| \frac{\partial(x,y,z)}{\partial(s,t,u)} \right| \, ds \, dt \, du.
        </me>
      </p>
    </assemblage>
    <worksheet>
  <activity workspace="1.5in" xml:id="A_11_9_5">
      <introduction>
        <p>
          Consider the solid <m>S'</m> defined by the inequalities <m>0 \leq x \leq 2</m>, <m>\frac{x}{2} \leq y \leq \frac{x}{2}+1</m>, and <m>0 \leq z \leq 6</m>. Consider the transformation defined by <m>s = \frac{x}{2}</m>, <m>t = \frac{x-2y}{2}</m>,  and <m>u = \frac{z}{3}</m>. Let <m>f(x,y,x) = x-2y+z</m>. 
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            The transformation turns the solid <m>S'</m> in <m>xyz</m>-coordinates into a box <m>S</m> in <m>stu</m>-coordinates. Apply the transformation to the boundries of the solid <m>S'</m> to find <m>stu</m>-coordinate descriptions of the box <m>S</m>.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Compute and simplify the Jacobian <m>\frac{\partial(x,y,z)}{\partial(s,t,u)}</m>.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
             Use the transformation to perform a change of variables and evaluate <m>\iiint_{S'} f(x,y,z) \, dV</m> by evaluating 
            <me>\iiint_{S} f(x(s,t,u),y(s,t,u),z(s,t,u)) \ \left| \frac{\partial(x,y,z)}{\partial(s,t,u)} \right| \, ds \, dt \, du</me>
          </p>
        </statement>
      </task>
    </activity>
</worksheet>

  </subsection>

  

  <subsection>
    <title>Summary</title>
    <ul>
      <li>
        <p>
          If an integral is described in terms of one set of variables, we may write that set of variables in terms of another set of the same number of variables. If the new variables are chosen appropriately, the transformed integral may be easier to evaluate.
        </p>
      </li>

      <li>
        <p>
          The Jacobian is a scalar function that relates the area or volume element in one coordinate system to the corresponding element in a new system determined by a change of variables.
        </p>
      </li>
    </ul>

    </subsection>

    <xi:include href="exercises/ez-S_multi_ints_change_variables.ptx" />
</section>
