<?xml version="1.0"?>
<!-- **********************************************************************-->
<!-- Copyright 2013-2025                                                   -->
<!-- Nicholas Long, Mitch Keller                                           -->
<!--                                                                       -->
<!-- This file is part of Active Calculus Multivariable.                   -->
<!--                                                                       -->
<!-- Permission is granted to copy, distribute and/or modify this document -->
<!-- under the terms of the Creative Commons BY-NC-SA license.  The work   -->
<!-- may be used for free by any party so long as attribution is given to  -->
<!-- the author(s), the work and its derivatives are used in the spirit of -->
<!-- "share and share alike"; no party may sell this work or any of its    -->
<!-- derivatives for profit.  All trademarks are the registered marks of   -->
<!-- their respective owners.                                              -->
<!-- **********************************************************************-->
<section xml:id="S-MV-HD" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Higher Dimensions</title>
  <objectives>
    <ul>
      <li>
        <p>
          What is a level set of a function of three or more variables and what kinds of graphs can you describe with a level set like this?
        </p>
      </li>
      <li>
        <p>
          How do measurese of change like partial derivatives, differentials, directional derivatives, and gradients generalize to functions of more than two variables?
        </p>
      </li>
    </ul>
  </objectives>
  <introduction> 
    <p>
      In this chapter, we have primarily worked with functions of two variables including understand graphs of the form <m>z=f(x,y)</m> and measuring change with two variable functions. In this section, we will look at how many of the tools we have developed for understanding two variable functions can be easily generalized for functions of three or more variables. We will not give new definitions for the various ideas in this section since the definitions would often be too technical and would not change how we use or understand these ideas.
    </p>
    <p>  
      A significant impediment to expanding the ideas in this chapter to functions of three or more variables will be that is it difficult (or impossible) to draw plots of these functions, which means we can only make sense of the measurements we are working with geometrically using simplifications or analogies. For this reason, most of our work in this section and where you will see these topics used in future classes will be more algebraically focused.
    </p>
    <p>
      In the following preview activity, we will look at level sets for two familiar functions of two variables and start to explore how level sets can help visualize functions of three variables. 
    </p>
    <exploration xml:id="PA-MV-HD">
      <task>
        <statement>
          <p>
            Find the level curves for the function <m>f(x,y)=x^2+y^2</m> over the values <m>k=\{-2,-1,0,1,2\}</m>. State the equation and shape of the level curves for each value.
          </p>
        </statement>
        <hint>
          <p>
            Some of these level sets will be empty, meaning that there are no <m>(x,y)</m> points that have the particular <m>k</m>-value as output. 
          </p>
        </hint>
      </task>
      <task>
        <statement>
          <p>
            Find the level curves for the function <m>g(x,y)=x^2-y^2</m> over the values <m>k=\{-2,-1,0,1,2\}</m>. State the equation and shape of the level curves for each value.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            In general, the <term>level set</term> of a function <m>f</m> will be the set of points for which <m>f(P)=k</m> for some constant <m>k</m>. We will look at some algebraically simple functions of three variables to see what kinds of level sets are possible. We use the term level set here because the set of inputs for a function of three or more variables that gives a particular output value will likely not be a curve.
          </p>
          <p>
            Find the level set for the function <m>f(x,y,z)=x^2+y^2+z^2</m> over the values <m>k=\{-2,-1,0,1,2\}</m>. Be sure to state the equation and shape of the level set for each value. 
          </p>
        </statement>
        <hint>
          <p>
            Some of these level sets will be empty. 
          </p>
        </hint>
      </task>
      <task>
        <statement>
          <p>
            Find the level set for the function <m>g(x,y,z)=x^2+y^2-z^2</m> over the values <m>k=\{-2,-1,0,1,2\}</m>. Be sure to state the equation and shape of the level set for each value. These level set values should give three different types of surfaces.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Find the level set for the function <m>h(x,y,z)=x+y-z</m> over the values <m>k=\{-2,-1,0,1,2\}</m>. Be sure to state the equation and shape of the level set for each value.
          </p>
        </statement>
      </task>
    </exploration>
    <p>
      We will now generalize these ideas of level sets to start our exploration for functions of three or more variables. As we have for most kinds of functions in previous precalculus and calculus courses, we will look at the following ideas in order: domain and range of functions, graphs of functions, limits of functions, and finally, measuring change of function. 
    </p>
  </introduction>
  <subsection>
    <title>Inputs and Outputs with Functions of Three or More Variables</title>
    <p>
      We will first generalize the notion of function and the corresponding ideas of domain and range to deal with three or more input variables. A function is a rule that assigns an single output for each allowed input. For instance, your school likely uses a function that takes your student ID number as an input and outputs your name. While you may not be the only student at your school with your name, this function should not associate more than one name with each student ID number.
    </p>  
    <p>  
      Recall from <xref ref="domainrange_defn"/>, that the domain of a function is the set of inputs for which a function is defined and the range is the set of outputs that a function actually uses. 
    </p>
    <example>
      <p>
        For example, the function <m>g(x,y,z)= \sqrt{1-x}+e^{y^2+z^2}</m> could only have a domain as large as <m>\{(x,y,z) \in \mathbb{R}^3| x \leq 1\}</m> because we need <m>x</m> to be greater than 1 (in order for the first term to make sense) and there is no restriction on what values of <m>y</m> and <m>z</m> will make sense as an input of <m>g</m>. You may be tempted to say the range of <m>g</m> is all real numbers since <m>g</m> does have a scalar output, but negative numbers are not possible to get as an output for <m>g</m>. Since the outputs of our exponential and square root functions will be non-negative, the range of <m>g</m> will be the interval <m>(0,\infty)</m>.
    </p>
  </example>  
  </subsection>  
  <subsection>
    <title>Attempting to Graph Functions of Three or More Variables</title>
    <p>
      Given a function of several variables, <m>f</m>, we call the level set of <m>f</m> at the value <m>k</m> to be the collection of inputs such that the output of <m>f</m> is exactly <m>k</m>. A level set must be a subset of the domain of the function <m>f</m> because the level set is a collection of the input points.
    </p>
    <p>
      If <m>f(x,y)</m> is a function of two variables, then a level set would correspond to a contour or a level curve of the form <m>f(x,y)=k</m>. Notice that the level set in this case is a set of points in the <m>xy</m>-plane (the space of inputs for our function <m>f</m>). As we saw in <xref ref="S-MV-Functions"/>, we can make a contour plot by graphing a collection of these level curves on the same 2D-plot, which will give us an idea of what the surface corresponding to <m>z=f(x,y)</m> would look like. In other words, we were able to give enough information in a 2D-plot to describe a figure in three dimensions.
    </p>
    <p>
      If <m>g(x,y,z)</m> is a function of three variables, then a graph of <m>g</m> function would require four dimensions (three dimensions for the inputs and one dimension for the output). Drawing plots in three dimensions is hard enough; four dimensions feels like too much to attempt. Similar to how we used contour plots to express a higher dimensional plot in a lower dimensional setting, we would like to use level sets of <m>g(x,y,z)</m> to understand a graph of <m>w=g(x,y,z)</m> and help measure change in the output of <m>g</m>.
    </p>
    <p>
      A level set of <m>g</m> is a collection of points in <m>xyz</m>-space (the set of inputs for our function <m>g</m>) and would correspond to a surface of the form <m>g(x,y,z)=k</m>. As you saw in <xref ref="PA-MV-HD"/>, the level sets of a function of three variables will often be a surface. For example, if <m>g(x,y,z)=x^2+y^2+z^2</m>, then the level surface corresponding to the value 1 will be given by the equation <m>x^2+y^2+z^2=1</m>, a sphere of radius one centered at the origin. 
    </p>
    <p>
      These level surfaces will often be a different kind of surface than we have been working with throughout <xref ref="C_MVF"/>. Surfaces of the form <m>z=f(x,y)</m> are called <term>explicit surfaces</term> because one of the coordinates can be solved (explicitly) as a function of the other coordinates. Surfaces like spheres or hyperboloids are NOT explicit surfaces because there is no way to solve for one variable as a function of the other coordinates (that pesky <m>\pm</m> that comes with square roots prevents this for many quadric surfaces). 
    </p>
    <p>
      Surfaces like spheres and hyperboloids are called <term>implicit surfaces</term> because they can be described the set of points that satisfy an implicit equation. For instance, a hyperboloid of one sheet can be described by an equation of the following form.
      <me>\frac{(x-x_0)^2}{a^2}+\frac{(y-y_0)^2}{b^2}=1+\frac{(z-z_0)^2}{c^2} </me>
      Conveniently, level sets for functions of several variables have an associated implicit equation, <m>g(x,y,z)=k</m>. 
    </p>
    <p>
      This insight goes the other way as well; Any implicit surface can be thought of as a level set for some function of three variables. If <m>S_1</m> is the surface described by <m>x^2-xyz=y^2 z^3-2</m>, then we can also think of <m>S_1</m> as the level set of the three variable function <m>F(x,y,z)=x^2-xyz-y^2 z^3</m> with the output of <m>-2</m> because any <m>(x,y,z)</m> point that satisfies <m>x^2-xyz=y^2 z^3-2</m> must also satisfy <m>x^2-xyz-y^2 z^3=-2</m>.
    </p>
    <example xml:id="implicitex1">
      <p>
        Analogous to how a (two-dimensional) contour plot gives us a lot of information about the corresponding (three-dimensional) surface plot, we would like to see if we can graph multiple level sets of a three variable function to understand the 4D graph of a function of the form <m>w=g(x,y,z)</m>. In this example, we will work with the three variable function <m>g(x,y,z)=x^2+y^2-z^2</m>.
      </p>
      <p>
        If we consider the level sets corresponding to the values <m>k=\{-4,-1,0,1,4\}</m>, we get the following level surfaces:
        <ul> 
          <li>If <m>k=-4</m>, then we are looking at the implicit equation <m> x^2+y^2-z^2=-4</m> which corresponds to a hyperboloid of two-sheets given by <m> \frac{z^2}{4}-\frac{x^2}{4}-\frac{y^2}{4}=1 </m>.</li>
          <li>If <m>k=-1</m>, then we are looking at the implicit equation <m> x^2+y^2-z^2=-1</m> which corresponds to a hyperboloid of two-sheets given by <m> z^2-x^2-y^2=1 </m>.</li>
          <li>If <m>k=0</m>, then we are looking at the implicit equation <m> x^2+y^2-z^2=0</m> which corresponds to a cone given by <m> x^2+y^2=z^2 </m>.</li>
          <li>If <m>k=1</m>, then we are looking at the implicit equation <m> x^2+y^2-z^2=1</m> which corresponds to a hyperboloid of one-sheet given by <m> x^2+y^2-z^2=1 </m>.</li>
          <li>If <m>k=4</m>, then we are looking at the implicit equation <m> x^2+y^2-z^2=-4</m> which corresponds to a hyperboloid of one-sheet given by <m> \frac{x^2}{4}+\frac{y^2}{4}-\frac{z^2}{4}=1 </m>.</li>
        </ul>
        We can plot these level sets together to get the analogous plot to a contour plot. <xref ref="contour3d"/> shows a graph of these surfaces with colors that go from red (at <m>k=-4</m>) to blue (at <m>k=4</m>). You can see how a 3D plot of multiple level sets gets visually cluttered very quickly, but you can see how the output of <m>g</m> will increase as you move away the <m>z</m>-axis or if you move closer to the <m>xy</m>-plane. Later in this section we will explore how these level surfaces are related to questions like <q>In what direction will the output of <m>g</m> have the greatest rate of increase?</q>
      </p>
      <figure xml:id="contour3d">
        <caption>A plot of the level surfaces for <m>g(x,y,z)=x^2+y^2-z^2</m> for values <m>k=\{-4,1,0,1,4\}</m> in colors from red to blue, respectively. </caption>
        <interactive title="interactive-contour3d" platform="sage" width="85%" aspect="1:1">
          <slate surface="sage">
            from sage.plot.plot3d.plot3d import axes
            var('x,y,z,t,s')
            scale=3;
            c=["red","orange","yellow","green","blue"]
            o=[0.4,0.35,0.35,0.3,0.3]
            kval=[-4,-1,0,1,4]
            plot2=axes(scale,1,color="black",aspect_ratio=1)+text3d("x",(scale+0.5,0,0),fontsize=30)+text3d("y",(0,scale+0.5,0),fontsize=30)+text3d("z",(0,0,scale+0.5),fontsize=30)
            for i in range(0,len(kval)):
              k=kval[i]
              if(i==0 or i==1):
                plot2+=parametric_plot3d((s*cos(t),s*sin(t),sqrt(s^2-k)),(t,0,2*pi),(s,-3,3),color=c[i],opacity=o[i])
                plot2+=parametric_plot3d((s*cos(t),s*sin(t),-sqrt(s^2-k)),(t,0,2*pi),(s,-3,3),color=c[i],opacity=o[i])
              else:
                plot2+=parametric_plot3d((sqrt(k+s^2)*cos(t),sqrt(k+s^2)*sin(t),s),(t,0,2*pi),(s,-3,3),color=c[i],opacity=o[i])
            show(plot2,viewpoint=[[-0.2939,-0.6246,-0.7236],142.39],camera_position=[12.5948,10.0857,2.382])
          </slate>
        </interactive>
      </figure>
      <p>
        While the plot of multiple level surfaces may be a bit overwhelming, we can show each of these level sets in a separate plot. <xref ref="plot4d"/> plots a level surface for the value given by the slider at the top. You should use the slider to change the value of <m>k</m> over the entire range from -4 to 4 and look at how the shape of the corresponding level surface morphs from hyperboloid of two sheets to a cone to a hyperbola of one sheet.
      </p>
      <figure xml:id="plot4d">
        <caption>A plot of the level surface for <m>g(x,y,z)=x^2+y^2-z^2</m> with a slider for changing the level curve value from -4 to 4 </caption>
        <interactive title="interactive-plot4d" platform="sage" width="100%" aspect="1:1">
          <slate surface="sage">
            <xi:include href="interacts/implicitplotslider.txt" parse="text" />
          </slate>
        </interactive>
      </figure>
      <p>
        <xref ref="plot4d"/> may look like a three dimensional plot, but we really have a four dimensional plot with the fourth dimensional axis given by the slider. We saw a similar case in <xref ref="vvf-example1"/> where the plot of <m>\vr(t)</m> was really a four dimensional idea (one dimension for the input changing with the <m>t</m>-axis for the slider and the three dimensional output of <m>\vr</m> is shown with the vector in standard position or a plot of the terminal point). With our vector valued functions of one variables, we simplified our four dimensional plot to include <em>all</em> of the 3D outputs but we often ignored plotting how those outputs depended on the value of the parameter <m>t</m>.
      </p>
    </example>
    <activity xml:id="level-grad">
      <introduction>
        <p>
          In this activity, we will look at level surfaces created by two relatively basic three variable functions and consider the direction in which the output is increasing or decreasing as fast as possible. 
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            What shape and characteristics will the level surfaces of <m>f(x,y,z)=2x-y+z</m> have? You should talk about all of the possibilities for the different types of level surfaces and compare what is the same or different about these level surfaces (relating the differences to the level value, <m>k</m>).
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            If you are at the point <m>(1,1,-1)</m>, in what direction should you change the input of <m>f(x,y,z)=2x-y+z</m> to see the greatest increase in the output of <m>f</m>? You should think about how a change in each variable will change the output of <m>f</m> and talk about this in your reasoning. 
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            What shape and characteristics will the level surfaces of <m>g(x,y,z)=x^2+y^2+z^2</m> have? You should talk about <em>all</em> of the possibilities for the different types of level surfaces and compare what is the same or different about these level surfaces (relating the differences to the level value, <m>k</m>).
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            If you at the point <m>(2,0,-2)</m>, in what direction should you change the input of <m>g(x,y,z)=x^2+y^2+z^2</m> to see the greatest increase in the output of <m>f</m>? You should think about how a change in each variable will change the output of <m>f</m> and talk about this in your reasoning. 
          </p>
        </statement>
      </task>
    </activity>
  </subsection>
  <subsection xml:id="subsec-3plusdiff">
    <title>Measuring Change with Functions of Three or More Variables</title>
    <p>
      Conceptually, limits for functions of three or more variables works the same as for functions of two variables. 
      Given a function <m>f</m>, we say that <m>f</m> <term>has limit <m>L</m> as the inputs approach <m>P_0</m></term> provided that we can make <m>f(P)</m> as close to <m>L</m> as we like by taking <m>P</m> sufficiently close (but not equal) to <m>P_0</m>. We write
        <me>
          \lim_{P \to P_0} f(P) = L
        </me>
      Conceptually, if the limit of a function <m>f</m> along every path through an input point <m>P_0</m> exists and all of those limits are the same value, <m>L,</m>, then we say the limit of <m>f</m> at <m>P</m> is <m>L</m>. There is not much more insight into limits of multivariable functions to be had at this point, so we will move on to measuring the change in output of our multivariable functions of three or more variables. 
    </p>

    <p>
      Generally speaking, the partial derivative of a multivariable function measures the rate of change in the output of the function when one variable is changed and all others are held constant. Our definition and notation of partial derivatives only needs to account for three or more input variables.
    </p>
    <example>
      <p>
        If we consider <m>T(x,y,z,t)</m> to be the function that measures the air temperature at some location given by <m>(x,y,z)</m> spatial coordinates at time <m>t</m>, then we have four (first) partial derivatives: <m>T_x=\frac{\partial T}{\partial x}</m>, <m>T_y=\frac{\partial T}{\partial y}</m>, <m>T_z=\frac{\partial T}{\partial z}</m>, and <m>T_t=\frac{\partial T}{\partial t}</m>. The limit definition of the partial derivative with respect to <m>t</m> at a point <m>(x_0,y_0,z_0,t_0)</m> would be 
        <me>\frac{\partial T}{\partial z} =\lim_{h \to 0} \frac{T(x_0,y_0,z_0,t_0+h)-T(x_0,y_0,z_0,t_0)}{h} </me>
        and would measure the instantaneous rate of change in temperature over time at the location <m>(x_0,y_0,z_0)</m> for when <m>t=t_0</m>.
      </p>
      <p>
        Second partial derivatives will work the same as for functions with two variable functions. For example, 
        <me>T_{yt}=\frac{\partial T_y}{\partial t} = \frac{\partial }{\partial t}\left[ \frac{\partial T}{\partial y} \right]</me>
        would measure the rate of change with respect to time of <m>T_y</m>. Our function will have sixteen second partial derivatives (4 unmixed partials and 12 mixed partials).
      </p>
    </example>
    <p>
      <xref ref="Clairaut" text="custom">Clairaut's Theorem</xref> also generalizes to higher dimensions; if all mixed partials are continuous near an input point for our function of three or more variables, then the comparable mixed partials will be equal. 
    </p>
    <p>
      In <xref ref="S-10-4-Linearization"/>, we saw how the ideas of locally linear functions and differentiability meant that for small scales, the change in the output of our function could be expressed as a linear combination of the changes in each variable separately. This connected to the idea that the linearization of a function approximates the original function well for small neighborhoods around the point at which the linearization was created. We visualized this linearization with the tangent plane and saw that geometrically speaking, the tangent plane was a good approximation for the surface at small scales. 
    </p>
    <p>
      Unfortunately, we will not be able to use this kind of visualization for functions of three or more variables because our graphing techniques are limited to looking at plots of level surfaces. We can however use linearizations to approximate the change in functions of three or more variables. For example, if we consider <m>T(x,y,z,t)</m> to be the function that measures the air temperature at some location given by <m>(x,y,z)</m> spatial coordinates at time <m>t</m>, then the linearization of this function at a location at location <m>(a,b,c)</m> with time <m>t=d</m> will be 
      <md>
        <mrow> L(x,y,z,t)=\amp T(a,b,c,d)(x-a)+ T_x(a,b,c,d) (x-a) </mrow>
        <mrow> \amp \quad +T_y(a,b,c,d) (y-b)+T_z(a,b,c,d) (z-c)</mrow>
        <mrow> \amp \quad +T_t(a,b,c,d) (t-d)</mrow>
      </md>
      Notice this is the same form as we have used for all of our linear ideas; namely the change in the output is a linear combination of the changes with respect to a change in a single input variable (while holding all other inputs constant).
    </p>
    <p>
      We can easily generalize related ideas like the differential to functions of three or more variables. The differential for our temperature function is given by 
      <me>dT = \frac{\partial T}{\partial x} dx + \frac{\partial T}{\partial y} dy + \frac{\partial T}{\partial z} dz + \frac{\partial T}{\partial t} dt </me>
      Other important ideas, like the classic calculus approach or our interpretation of the gradient, did not depend on using a function of two variables, so we can easily adapt these arguments and results to higher dimensional cases. Again, the downside to all of this abstraction is that we do not have the geometric tools to interpret and understand our measurements in higher dimensions.
    </p>
  </subsection>
  <subsection xml:id="HD-gradient">
    <title>Directional Derivatives and Gradients</title>
    <p>
      Directional derivatives and gradients for functions of three or more variables will come up several times in this course (and in many subsequent math/physical science/economics courses), so we will take a little bit of time to talk about the definitions and interpretations now. Recall that the <xref ref="S-10-6-Directional-Derivative">directional derivative</xref> measures the instantaneous rate of change of a multivariable function when the inputs are changed in a particular direction. None of the arguments in <xref ref="S-10-6-Directional-Derivative"/> were specific to functions of two variables, but rather than stating these results in terms of an abstract function of <m>n</m>-variables, we will state the various definitions and results in terms of functions of either three or four variables, <m>f(x,y,z)</m> or <m>g(x,y,z,w)</m>. 
    </p>
    <p>
      Let <m>f = f(x,y,z)</m> be a function of three variables. The <term>derivative of <m>f</m> at the point <m>(x,y,z)</m> in the direction of the unit vector <m>\vu = \langle u_1, u_2 , u_3 \rangle</m></term><idx><h>directional derivative</h></idx> is denoted <m>D_{\vu}f(x,y,z)</m> and is given by
      <men>
        D_{\vu}f(x,y,z) = \lim_{t \to 0} \frac{f(x+u_1 t, y+u_2 t, z+u_3t) - f(x,y,z)}{t}
      </men>
      for those values of <m>x</m>, <m>y</m>, and <m>z</m> for which the limit exists. We can make a similar limit definition for a function of more than three variables because we are able to separate the length of the step in a particular direction (<m>t</m> in the above statement) and the unit vector in that particular direction (<m>\vu</m> from above) for vectors with any number of components. 
    </p>
    <p>
      We can <xref ref="Directional-derivative">calculate the directional derivative</xref> in terms of partial derivatives of our function and <m>\vu</m>. This result comes from using the chain rule on a composition of our multivariable function with line in the direction of <m>\vu</m>. So if <m>f(x,y,z)</m> and <m>g(x,y,z,w)</m>, then
      <me>D_{\vu} f(x,y,z)= f_x(x,y,z) u_1 + f_y(x,y,z) u_2 +f_z(x,y,z) u_3</me>
      and
      <me>D_{\vu} g(x,y,z,w)= g_x(x,y,z,w) u_1 + g_y(x,y,z,w) u_2 +g_z(x,y,z,w) u_3+ g_w(x,y,z,w) u_4</me>
      Remember that the direction vector will have as many components as there are inputs to our function because the direction vector corresponds to a change in the inputs of the function. 
    </p>
    <p>
      The formulas above have the same form of a dot product of the gradient and the direction vector:
      <me>D_{\vu} f(x,y,z)= \nabla f \cdot \langle u_1,u_2, u_3\rangle</me>
      and 
      <me>D_{\vu} g(x,y,z,w)= \nabla g \cdot \langle u_1,u_2, u_3,u_4\rangle </me>
      where <m>\nabla f =\langle f_x(x,y,z), f_y(x,y,z) , f_z(x,y,z)\rangle</m> and <m>\nabla g = \langle g_x(x,y,z,w), g_y(x,y,z,w) , g_z(x,y,z,w), g_w(x,y,z,w)\rangle</m>.
      This generalization shows that in any dimension, the directional derivative can be calculated as the dot product of the gradient and the direction vector. 
    </p>
    <p>
      This also means that all of our work to <xref ref="vec-grad">understand the meaning of the gradient</xref> will generalize to any dimension as well. In particular, we update our summary of the meaning of the gradient below. 
    </p>
    <assemblage xml:id="Gradient2">
      <title>The Meaning of the Gradient as a Vector</title>
      <p>
        Let <m>f</m> be a differentiable function and <m>P</m> a point for which <m>\nabla f(P) \ne \vzero</m>. 
      </p>
      <p>
        <ul>
          <li>The gradient, <m>\nabla f (P)</m> points in a direction perpendicular to the level curve <m>f(P)=k</m>.</li>
          <li>The gradient, <m>\nabla f (P)</m>, points in the direction of greatest rate of increase for <m>f</m> at <m>P</m>, and the instantaneous rate of change of <m>f</m> in that direction is the length of the gradient vector. That is, if <m>\vu = \frac{1}{\vecmag{\nabla f(P)}} \nabla f(P)</m>, then <m>\vu</m> is a unit vector in the direction of greatest increase of <m>f</m> at <m>P</m>, and <m>D_{\vu} f(P) = \vecmag{\nabla f(P)}</m>. </li>
          <li>The gradient, <m>\nabla f(P)</m>, points in the opposite direction of greatest rate of decrease for <m>f</m> at <m>P</m>, and the instantaneous rate of change of <m>f</m> in that direction is negative the length of the gradient vector. That is, if <m>\vu = - \frac{1}{\vecmag{\nabla f(P)}} \nabla f(P)</m>, then <m>\vu</m> is a unit vector in the direction of greatest decrease of <m>f</m> at <m>(P)</m>, and <m>D_{\vu} f(P) = -\vecmag{\nabla f(P)}</m>. </li>
        </ul>
      </p>
    </assemblage>
    <p>
      The first idea above will be very important tool in finding an equation for the plane tangent to an implicit surface. Let <m>P_1</m> be a point on <m>S_1</m>, an implicit surface given by <m>F(P)=k</m>. The tools of <xref ref="S-10-4-Linearization"/> will not work because our surface is not of the form <m>z=f(x,y)</m>. Because <m>\nabla F(P_1)</m> is perpendicular to the surface <m>S_1</m>, <m>\nabla F(P_1)</m> will be a normal vector for the tangent plane at <m>P_1</m>. This leads to the following key idea.
    </p>
    <proposition xml:id="implicittanplane">
      <statement>
        <p>
          Let <m>S_1</m> be an implicit surface given by <m>F(x,y,z)=k</m> and let <m>P_0=(x_0,y_0,z_0)</m> be a point on <m>S_1</m>. The tangent plane to <m>S_1</m> at <m>P_0</m> will be given by 
          <me>\frac{\partial F}{\partial x}(P_0) (x-x_0)+ \frac{\partial F}{\partial y}(P_0) (y-y_0) +\frac{\partial F}{\partial z}(P_0) (z-z_0)=0</me>
        </p>
      </statement>
      <proof>
        <p>
          By <xref ref="Plane-scalar-equation"/> we need to find a normal vector for the plane and a point on the plane. The point <m>P_0=(x_0,y_0,z_0)</m> is the location where our tangent plane will intersect <m>S_1</m> so we only need to find a normal vector for our plane. By our interpretation of the gradient above, <m>\nabla F (P_0)= \langle \frac{\partial F}{\partial x}(P_0), \frac{\partial F}{\partial y}(P_0), \frac{\partial F}{\partial z}\rangle</m> will be perpendicular to the level surface <m>S_1</m>. Therefore, 
          <me>\frac{\partial F}{\partial x}(P_0) (x-x_0)+ \frac{\partial F}{\partial y}(P_0) (y-y_0) +\frac{\partial F}{\partial z}(P_0) (z-z_0)=0</me>
        </p>
      </proof>
    </proposition>
    <example>
    <p>
      In this example, we will look at the function <m>f(x,y,z)=x^2+y^2+z^2</m> and the meaning of its gradient, <m>\nabla f = \langle 2x,2y,2z\rangle </m>. In order to visualize the graph of <m>f</m> we can look at a level surface given by <m> f(x,y,z)=k</m>. In <xref ref="gradspheres"/>, you can see a plot of the level surface for a value of <m>k</m>. Note that the level surfaces of <m>f</m> will be spheres centered at the origin or radius <m>R=\sqrt{k}</m>. You can use the slider at the top of <xref ref="gradspheres"/> to change the value of <m>k</m> and see how the scale of the level surface changes but the shape does not.
    </p>
    <figure xml:id="gradspheres">
        <caption>A plot of a level surfaces for <m>g(x,y,z)=x^2+y^2+z^2</m> with the option to plot gradient vectors for some points on the level surface </caption>
        <interactive title="interactive-gradspheres" platform="sage" width="100%" aspect="1:1.15">
          <slate surface="sage">
            from sage.plot.plot3d.plot3d import axes
            var('x,y,z,t,s')
            scale=5;
            @interact
            def spheregrad(k=slider(0.5,9,0.1,default=2,label="level surface value, k="),g=checkbox(default=False,label="Show Gradient Vectors")):
              R=sqrt(k);
              n=6;m=9;
              param(s,t)=(R*sin(s)*cos(t),R*sin(s)*sin(t),R*cos(s))
              grad(s,t)=(2*R*sin(s)*cos(t),2*R*sin(s)*sin(t),2*R*cos(s))
              plot3=axes(scale,1,color="black",aspect_ratio=1)+text3d("x",(scale+0.5,0,0),fontsize=30)+text3d("y",(0,scale+0.5,0),fontsize=30)+text3d("z",(0,0,scale+0.5),fontsize=30)
              plot3+=parametric_plot3d(param(s,t),(s,0,pi),(t,0,2*pi),color="blue",mesh=True,opacity=0.4,plot_points=21)
              if(g):
                for i in range(n):
                  sv=i*pi/n;
                  for j in range(m):
                    tv=j*2*pi/m;
                    plot3+=arrow(param(sv,tv),param(sv,tv)+grad(sv,tv),color="red",opacity=0.5,width=3)
              show(plot3)
          </slate>
        </interactive>
      </figure>
      <p>
        On <xref ref="gradspheres" />, you can use the checkbox to show the gradient vector plotted at a collection of points on the level surface. If you turn on the gradient vectors, you can see that the gradient vector will be perpendicular to the level surface and this relationship is true regardless of what value of <m>k</m> is used for the level surface. Two other properties should be noticed as well; First, the gradient always points out of the sphere in a direction opposite the origin and second, the length of the gradient is increasing as <m>k</m> is increasing. 
      </p>
      <p>  
        The function <m>f</m> will take a point <m>(x,y,z)</m> as input and output the square of the distance to this point from the origin. So <m>f</m> will increase as long as you move away from the origin, but the direction of <em>greatest</em> increase is to move directly away from the origin. The rate of increase in <m>f</m> also increases as you get farther away from the origin. Both of these ideas are demonstrated in <xref ref="gradspheres"/> by the red gradient vectors. Specifically, you can see that length of the gradient vectors increases as you increase <m>k</m> and the direction of the gradient vectors is always perpendicular to the level surface/sphere. You can also reason that the direction for greatest decrease in <m>f</m> will be in the direction going toward the origin.
      </p>
      <p>
        We can verify <xref ref="implicittanplane"/> by looking at tangent points for a few points on these spheres as level surfaces. Let <m>S_1</m> be the level surface with value 1, <m>f(x,y,z)=1=x^2+y^2+z^2</m>. Note that <m>P_0=(0,-1,0)</m> is on <m>S_1</m> and <m>\nabla f(P_0)=\langle 0,-2,0\rangle</m>. So by <xref ref="implicittanplane"/>, the tangent plane to <m>S_1</m> at <m>P_0</m> will be given by 
        <me> (0)(x-0)+(-2)(y+1)+(0)(z-0)=0 \rightarrow y=-1</me>
        This point, normal vector, and tangent plane is shown in red for <xref ref="spheretanplanes"/>.
      </p>
      <figure xml:id="spheretanplanes">
        <caption> </caption>
          <interactive title="interactive-spheretanplanes" platform="sage" width="100%" aspect="1:1">
            <slate surface="sage">
              <xi:include href="interacts/sphtanplanes.txt" parse="text" />
            </slate>
          </interactive>
      </figure>
      <p>
        If we look at another point on <m>S_1</m> like <m>P_1=(\frac{\sqrt{2}}{2},0,-\frac{\sqrt{2}}{2}) </m>, we can apply the same argument. Note that <m> \nabla f(P_1)=\langle \sqrt{2},0,-\sqrt{2}\rangle</m>, so our tangent plane will be given by
        <me> (\sqrt{2})\left(x-\frac{\sqrt{2}}{2}\right)+(0)(y-0)+(-\sqrt{2})\left(z-\frac{\sqrt{2}}{2}\right)=0 \rightarrow x-z=\sqrt{2}</me>
        This point, normal vector, and tangent plane is shown in green for <xref ref="spheretanplanes"/>.
      </p>
      </example>
      <example>
        <p>
          In this example, we will look at the function <m>g(x,y,z)=x^2+y^2-z^2</m>, the level surfaces of <m>g</m>, and the meaning of the gradient of <m>g</m>, given by <m>\nabla g = \langle 2x,2y,-2z\rangle </m>. In <xref ref="implicitex1"/> we saw how different values of <m>k</m> for the level surfaces gives rise to different types of surfaces. In <xref ref="gradhypcone" />, you can use the slider to change the level surface value and see how the shape of the level surfaces changes depending on the value of <m>k</m>. In particular, you should notice that 
          <ul>
            <li>if <m>k\lt 0</m>, the level surface will be a hyperboloid of two sheets</li>
            <li>if <m>k = 0</m>, the level surface will be a cone</li>
            <li>if <m>k \gt 0</m>, the level surface will be a hyperboloid of one sheet</li>
          </ul>
        </p>
        <figure xml:id="gradhypcone">
        <caption>A plot of a level surfaces for <m>g(x,y,z)=x^2+y^2+z^2</m> with the option to plot gradient vectors for some points on the level surface </caption>
        <interactive title="interactive-gradhypcone" platform="sage" width="100%" aspect="1:1.15">
          <slate surface="sage">
            from sage.plot.plot3d.plot3d import axes
            var('x,y,z,t,s')
            scale=5;
            @interact
            def hypconegrad(k=slider(-6,6,1,default=2,label="level surface value, k="),g=checkbox(default=False,label="Show Gradient Vectors")):
              n=5;m=6;d=4;
              plot3=axes(scale,1,color="black",aspect_ratio=1)+text3d("x",(scale+0.5,0,0),fontsize=30)+text3d("y",(0,scale+0.5,0),fontsize=30)+text3d("z",(0,0,scale+0.5),fontsize=30)
              if(sign(k)==-1):
                param(s,t)=(s*cos(t),s*sin(t),-sqrt(s^2-k))
                param2(s,t)=(s*cos(t),s*sin(t),sqrt(s^2-k))
                grad(s,t)=(2*s*cos(t),2*s*sin(t),2*sqrt(s^2-k))
                grad2(s,t)=(2*s*cos(t),2*s*sin(t),-2*sqrt(s^2-k))
                plot3+=parametric_plot3d(param(s,t),(t,0,2*pi),(s,-d,d),color="blue",opacity=0.5,mesh=True)
                plot3+=parametric_plot3d(param2(s,t),(t,0,2*pi),(s,-d,d),color="blue",opacity=0.5,mesh=True)
              else:
                param(s,t)=(sqrt(k+s^2)*cos(t),sqrt(k+s^2)*sin(t),s)
                grad(s,t)=(2*sqrt(k+s^2)*cos(t),2*sqrt(k+s^2)*sin(t),-2*s)
                plot3+=parametric_plot3d(param(s,t),(t,0,2*pi),(s,-d,d),color="blue",opacity=0.5,mesh=True)
              #plot3+=parametric_plot3d(param(s,t),(s,0,pi),(t,0,2*pi),color="blue",mesh=True,opacity=0.4,plot_points=21)
              if(g):
                for i in range(n+1):
                  sv=-d+i*2*d/n;
                  for j in range(m):
                    tv=j*2*pi/m;
                    plot3+=arrow(param(sv,tv),param(sv,tv)+grad(sv,tv),color="red",opacity=0.5,width=3)
                    if(sign(k)==-1):
                      tv=j*2*pi/m+pi/m
                      plot3+=arrow(param2(sv,tv),param2(sv,tv)+grad2(sv,tv),color="red",opacity=0.5,width=3)
              show(plot3,viewpoint=[[-0.2556,-0.5906,-0.7655],143.35],camera_position=[22.801,21.411,8.8665])
          </slate>
        </interactive>
        <p>
          We can use the same type of argument as the previous example to create tangent planes to the implicit surfaces of the form <m>g(x,y,z)=k</m>. Remember that <m>\nabla g=\langle 2x,2y,-2z\rangle </m>. We will describe a tangent plane at each of the following points on each of the following surfaces:
          <ul>
            <li>The tangent plane to the surface with <m>k=-1</m> at the point <m>P_1=(-1,1,\sqrt{3})</m> will be given by </li>
          </ul>
        </p>
      </figure>
      <p>
        It may be a bit weird to think that all three of these surfaces are a level surface of <m>g</m> where the algebraic form of <m>\nabla g</m> is not changing. If you select the checkbox in <xref ref="gradhypcone"/> to plot gradient vectors at points along your level surface, you will see that the gradient vectors will be perpendicular to the level surface. You can use the slider to change the value of the level surface, which will also change the shape of the level surface when you go from positive to negative or viceversa. 
      </p>
      <p>
        Returning to the function <m>g(x,y,z)=x^2+y^2-z^2</m>, we can ask <q>For an input point <m>(a,b,c)</m>, in what direction will the output of <m>g</m> be increasing at the greatest rate?</q> We can group the output of <m>g</m> into two terms <m>x^2+y^2</m> which increases as you move away from the <m>z</m>-axis and <m>-z^2</m> which increases as you get closer to the <m>xy</m>-plane (<m>z=0</m>). An input point of <m>(a,b,c)</m> for the gradient vector gives <m>\nabla g (a,b,c)=\langle 2a,2b,-2c\rangle</m>. Notice that for any point in our space, this gradient vector will point away from the <m>z</m>-axis and toward the <m>xy</m>-plane, as demonstrated by the red vectors in <xref ref="gradhypcone"/>. Note that our arguments are rotationally symmetric about the <m>z</m>-axis. 
      </p>
      <p>
        We can verify <xref ref="implicittanplane"/> by looking at tangent points for a point on these level surfaces. Let <m>S_k</m> be the level surface with value k, <m>g(x,y,z)=1=x^2+y^2-z^2</m> where <m>P_k=(-1,1,\sqrt{2-k})</m> is on <m>S_k</m> and <m>\nabla g(P_k)=\langle -2,2,-2\sqrt{2-k}\rangle</m>. So by <xref ref="implicittanplane"/>, the tangent plane to <m>S_k</m> at <m>P_k</m> will be given by 
        <me> (-2)(x+1)+(2)(y-1)+(-2\sqrt{2-k})(z-\sqrt{2-k})=0</me>
        This point, the gradient vector (drawn at half length), and tangent plane are shown in red for <xref ref="hypconetanplanes"/>.
      </p>
      <figure xml:id="hypconetanplanes">
        <caption> </caption>
          <interactive title="interactive-hypconetanplanes" platform="sage" width="100%" aspect="1:1">
            <slate surface="sage">
              <xi:include href="interacts/hypconetanplanes.txt" parse="text" />
            </slate>
          </interactive>
      </figure>
      <p>
        You can use the slider to change the value of <m>k</m> using the slider at the top of <xref ref="hypconetanplanes"/> to see how even though the shape of the level surface changes, the gradient vector at <m>P_k</m> will still be orthogonal to the surface and will serve as a normal vector for our tangent plane.
      </p>
      </example>
      <activity>
        <introduction>
          <p>
            In this activity, we will look at the calculation and interpretation of the gradient for <m>f(x,y,z)=x+y-z</m> and <m>g(x,y,z)=z-x^2-y^2</m>.
          </p>
        </introduction>
        <task>
          <statement>
            <p>
              Calculate <m>\nabla f</m> and <m>\nabla g</m>.
            </p>
          </statement>
        </task>
        <task>
          <statement>
            <p>
              Draw the level surfaces of <m>f</m> for the values <m>k=\{-2,-1,0,1,2\}</m>. Write a few sentences about the shape of each of these level surfaces and describe how the level surfaces is changing in terms of the value of <m>k</m>.
            </p>
          </statement>
        </task>
        <task>
          <statement>
            <p>
              Write a few sentences about how the direction and magnitude of <m>\nabla f</m> is related to the level surfaces from the previous task. 
            </p>
          </statement>
        </task>
        <task>
          <statement>
            <p>
              Draw the level surfaces of <m>g</m> for the values <m>k=\{-2,-1,0,1,2\}</m>. Write a few sentences about the shape of each of these level surfaces and describe how the level surfaces are changing in terms of the value of <m>k</m>. Note here that each of the level surfaces can be expressed with <m>z</m> as a function of <m>x</m> and <m>y</m>.
            </p>
          </statement>
        </task>
        <task>
          <statement>
            <p>
              Write a few sentences about how the direction and magnitude of <m>\nabla g</m> is related to the level surfaces from the previous task. 
            </p>
          </statement>
        </task>
      </activity>
      <p>
        The level surfaces of the function <m>g(x)=z-x^2-y^2</m> from the previous activity were of the form <m>z=x^2+y^2+C</m> for some constant <m>C</m>, which meant that the gradient of <m>g</m> gives a convenient way of calculating a vector that will be perpendicular to the surface <m>z=x^2+y^2+C</m>. In fact, if we have a surface of the form <m>z=h(x,y)</m>, then the same surface will be a level surface of the three variable function <m>g(x,y,z)=z-h(x,y)</m>.
      </p>
  </subsection>
  <subsection>
    <title>Summary</title>
    <ul>
      <li>
        <p>
          The set of points <m>(x,y,z)</m> for which a function of three variables, <m>f(x,y,z)</m>, has a constant output, <m>k</m>, is called the level surface and a implicit equation of the level surface is <m>f(x,y,z)=k</m>.
        </p>
      </li>
      <li>
        <p>
          The partial derivatives for functions of functions three or more variables are calculated by measuring the rate of change in one input variable while holding all other inputs constant. The gradient of a function of three or more variables is a vector valued, multivariable function where each component is the first partial derivative of with respect to a different coordinate. If <m>g(x_1,x_2, \ldots,x_n)</m>, then the gradient of <m>g</m> has <m>n</m> components and is given by <m>\nabla g = \left\langle \frac{\partial g}{\partial x_1}, \frac{\partial g}{\partial x_2},\ldots,\frac{\partial g}{\partial x_m}\right\rangle</m>.
        </p>
      </li>

      <li>
        <p>
          The directional derivative of a function of three or more variables measures the rate of change of the output when the input variables are changed in a particular direction and can be calculated by <m>Dg_{\vu}(P)=\nabla g(P) \cdot \vu</m>.
        </p>
      </li>

      <li>
        <p>
          The gradient of a multivariable function <m>g</m> at an input <m>P</m> points in the direction of greatest rate of increase for the output of <m>g</m>, which also means that the gradient at <m>P</m>, <m>\nabla g(P)</m> will be perpendicular to the level surface corresponding to the value <m>k=g(P)</m>. The direction opposite of the gradient, <m>-\nabla g (P)</m>, will be the direction of greatest rate of decrease at <m>P</m>. The greatest rate of increase and decrease are <m>\vecmag{\nabla g(P)}</m> and <m>-\vecmag{\nabla g(P)}</m>, respectively.
        </p>
      </li>
    </ul>

    </subsection>
    <xi:include href="./exercises/ez-S_mv_HD.ptx" />
      
</section>
